
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Christopher Batten">
      
      
      
      
      
        
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>ECE 6745 Lab 3: TinyFlow Front End - ECE 6745 Complex Digital ASIC Design</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ece-6745-lab-3-tinyflow-front-end" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ECE 6745 Complex Digital ASIC Design" class="md-header__button md-logo" aria-label="ECE 6745 Complex Digital ASIC Design" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ECE 6745 Complex Digital ASIC Design
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ECE 6745 Lab 3: TinyFlow Front End
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/cornell-ece6745/ece6745-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    cornell-ece6745/ece6745-mkdocs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ece6745-tut00-remote-access/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ece6745-lab1/" class="md-tabs__link">
          
  
  
  Labs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ece6745-project1a/" class="md-tabs__link">
          
  
  
  Projects

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ece6745-tinyflow-180nm-drm/" class="md-tabs__link">
          
  
  
  Misc

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ECE 6745 Complex Digital ASIC Design" class="md-nav__button md-logo" aria-label="ECE 6745 Complex Digital ASIC Design" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ECE 6745 Complex Digital ASIC Design
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cornell-ece6745/ece6745-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    cornell-ece6745/ece6745-mkdocs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tut00-remote-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial 0: ECE Linux Server Remote Access
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tut01-linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial 1: Linux Development Environment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tut02-git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial 2: Git Distributed Version Control System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Labs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Labs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 1: Full-Custom Inverter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 2: Standard-Cell Inverter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 3: TinyFlow Front End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 4: TinyFlow Back End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 5: TinyRV2 Accelerators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Projects
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Projects
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Project 1: TinyFlow Tape-Out
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project 1: TinyFlow Tape-Out
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project1a/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part A: TinyFlow Standard Cells
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project1b/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part B: TinyFlow Front End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project1c/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part C: TinyFlow Back End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Misc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tinyflow-180nm-drm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tinyflow 180nm Design Rules Manual
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project2-ideas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project 2 Ideas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-logging-into-ecelinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Logging Into ecelinux
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Data Structures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Data Structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-nodes-and-trees" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1. Nodes and Trees
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-frontend-database-and-gui" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3. Frontend Database and GUI
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-synthesis-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Synthesis Algorithms
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Synthesis Algorithms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-verilog-parser" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1. Verilog Parser
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-printing-trees" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2. Printing Trees
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-matching-trees" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3. Matching Trees
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-capturing-subtrees" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4. Capturing Subtrees
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-replacing-trees" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.5. Replacing Trees
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-substitution" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.6. Substitution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-naive-technology-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.7. Naive Technology Mapping
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-the-frontend-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. The Frontend Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. The Frontend Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-two-state-rtl-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Two-State RTL Simulation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-four-state-rtl-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Four-State RTL Simulation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-synthesis" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 Synthesis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-fast-functional-gate-level-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4 Fast-Functional Gate-Level Simulation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-exercise-design-a-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.5 Exercise: Design a Decoder
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="ece-6745-lab-3-tinyflow-front-end">ECE 6745 Lab 3: TinyFlow Front End</h1>
<p>In this lab, we will explore both the data structures and algorithms used
in TinyFlow front end. We will implement a basic synthesis tool that
transforms Verilog RTL into a gate-level netlist and then use this
synthesis tool to create a very simple end-to-end front end flow which
includes two-state RTL simulation, four-state RTL s
walk through the
complete frontend verification flow for an RTL design.</p>
<ul>
<li>
<p><strong>Verilog Parser:</strong> Reads Verilog RTL and converts it into an internal
     tree representation of generic gates</p>
</li>
<li>
<p><strong>Substitution:</strong> Pattern matching and replacement operation that
     transforms trees by matching a find pattern and producing a new tree
     from a replace template</p>
</li>
<li>
<p><strong>Naive Technology Mapping:</strong> Maps generic gates to standard cells from
     your library using simple pattern substitution</p>
</li>
<li>
<p><strong>Gate-Level Netlist Writer:</strong> Outputs the mapped design as a Verilog
     gate-level netlist using your standard cells</p>
</li>
</ul>
<p>We will be using the following TinyFlow frontend synthesis flow.</p>
<p><img alt="" src="../img/lab3-frontend.png" /></p>
<p>We will begin by exploring the TinyFlow data structures using the REPL and
GUI. We will then implement a Verilog parser, tree printing, substitution,
and naive technology mapping. Finally, we will walk through the four-step
frontend flow (2-state simulation, 4-state simulation, synthesis,
fast-functional gate-level simulation) to verify a Full Adder design.</p>
<h2 id="1-logging-into-ecelinux">1. Logging Into <code>ecelinux</code></h2>
<p>Follow the same process as previous labs. Find a free workstation and log
into the workstation using your NetID and standard NetID password. Then
complete the following steps. These are the same steps as in the first lab
with one exception. We are now installing
the VS Code Surfer extension to be able to view waveforms.</p>
<ul>
<li>Start VS Code</li>
<li>Install the Remote-SSH extension and the Surfer extension</li>
<li>Use View &gt; Command Palette to execute Remote-SSH: Connect Current Window to Host...</li>
<li>Enter netid@ecelinux-XX.ece.cornell.edu where XX is an ecelinux server number</li>
<li>Use View &gt; Explorer to open your home directory on ecelinux</li>
<li>Use View &gt; Terminal to open a terminal on ecelinux</li>
<li>Start MS Remote Desktop</li>
</ul>
<p><img alt="" src="../img/tut00-vscode-remote-ssh.png" /></p>
<p><img alt="" src="../img/tut00-vscode-surfer.png" /></p>
<p>Now use the following commands to clone the repo we will be using for
today's lab.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>%<span class="w"> </span><span class="nb">source</span><span class="w"> </span>setup-ece6745.sh
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>%<span class="w"> </span><span class="nb">source</span><span class="w"> </span>setup-gui.sh
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>%<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>%<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:cornell-ece6745/ece6745-lab3<span class="w"> </span>lab3
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>lab3
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>%<span class="w"> </span>tree
</span></code></pre></div>
<p>Your repo contains the following directories:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>.
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>├── README.md
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>├── asic
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>│   └── build-fa
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>│       ├── 01-verilator-rtlsim
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>│       ├── 02-iverilog-rtlsim
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>│       ├── 03-tinyflow-synth
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>│       │   └── run.py
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>│       └── 04-tinyflow-ffglsim
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>├── rtl
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>│   ├── FullAdder.v
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>│   └── test
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>│       └── FullAdder-test.v
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>├── stdcells
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>└── tinyflow
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    ├── synth
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    │   ├── StdCellFrontEndView.py
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    │   ├── TinyFrontEndDB.py
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    │   ├── TinyFrontEndGUI.py
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>    │   ├── print_tree.py
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>    │   ├── substitute.py
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    │   ├── techmap_unopt.py
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>    │   ├── tinyv.lark
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>    │   └── verilog_parser.py
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>    └── tinyflow-synth
</span></code></pre></div>
<p>To make it easier to cut-and-paste commands from this handout onto the
command line, you can tell Bash to ignore the <code>%</code> character using the
following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>%<span class="w"> </span><span class="nb">alias</span><span class="w"> </span>%<span class="o">=</span><span class="s2">&quot;&quot;</span>
</span></code></pre></div>
<p>Now you can cut-and-paste a sequence of commands from this tutorial
document and Bash will not get confused by the <code>%</code> character which begins
each line.</p>
<p>Our frontend tools use the front-end view you developed in Project 1 Part A.
Copy your front-end view file into the lab3 folder:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>%<span class="w"> </span>cp<span class="w"> </span>project1-groupXX/stdcells/stdcells-fe.yml<span class="w"> </span>lab3/stdcells
</span></code></pre></div>
<h2 id="2-data-structures">2. Data Structures</h2>
<p>As discussed in lecture, TinyFlow represents logic designs as trees of
gates. Our synthesis tool will form these trees from Verilog and manipulate
them through various transformations. The trees are stored in a data
container called <code>TinyFrontEndDB</code>.</p>
<p>To get started, create a build directory and start the TinyFlow REPL:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>%<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab3/tinyflow/build
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab3/tinyflow/build
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>%<span class="w"> </span>../tinyflow-synth
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>TinyFlow<span class="w"> </span>Synth<span class="w"> </span>REPL<span class="w"> </span>v0.1
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>Type<span class="w"> </span><span class="s1">&#39;help()&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>available<span class="w"> </span>commands.
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>Type<span class="w"> </span><span class="s1">&#39;clear()&#39;</span><span class="w"> </span>to<span class="w"> </span>clear<span class="w"> </span>the<span class="w"> </span>screen.
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>Type<span class="w"> </span><span class="s1">&#39;exit()&#39;</span><span class="w"> </span>or<span class="w"> </span>Ctrl-D<span class="w"> </span>to<span class="w"> </span>quit.
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>tinyflow-synth&gt;
</span></code></pre></div>
<p>The <code>tinyflow-synth</code> tool is where we will implement our synthesis
algorithms. It provides a REPL for interactive exploration.</p>
<h3 id="21-nodes-and-trees">2.1. Nodes and Trees</h3>
<p>The base class for all gates is <code>Node</code>. Generic gates (AND2, OR2, NAND2,
NOR2, XOR2, NOT, INV, BUF) are Nodes that represent logic operations.
Standard cell gates (INVX1, NAND2X1, NOR2X1, etc.) are Nodes read in from
your front-end view. <code>Signal</code> nodes represent inputs and wires. There are
also special <code>Wildcard</code> nodes that we will explain later. Let's create a
simple tree and explore it:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">AND2</span><span class="p">(</span><span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">generic</span><span class="p">)</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></code></pre></div>
<p>Each node has a <code>type</code> (the gate name), <code>children</code> (its inputs), and
<code>generic</code> (True for generic gates, False for standard cell gates). Signal
nodes are leaf nodes with no children. Nodes also provide helper methods:
<code>is_signal()</code> returns <code>True</code> for Signal nodes, <code>is_wildcard()</code> returns
<code>True</code> for Wildcard nodes, and <code>==</code>/<code>!=</code> compare nodes by type.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">is_signal</span><span class="p">()</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kc">True</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">tree</span><span class="o">.</span><span class="n">is_signal</span><span class="p">()</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kc">False</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">_a</span><span class="o">.</span><span class="n">is_wildcard</span><span class="p">()</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="kc">True</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">a</span> <span class="o">==</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="kc">True</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">a</span> <span class="o">==</span> <span class="n">AND2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="kc">False</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">AND2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="n">AND2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="kc">True</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">AND2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="kc">False</span>
</span></code></pre></div>
<p>Go ahead and evaluate all input combinations using <code>tree.eval()</code> and
derive the truth table for <code>AND2(OR2(a, b), c)</code>.</p>
<h3 id="23-frontend-database-and-gui">2.3. Frontend Database and GUI</h3>
<p>Now let's use the frontend database to manage a design. To create a
database using <code>TinyFrontEndDB</code>, we first need to have our frontend view
ready. <code>StdCellFrontEndView</code> loads the front-end view YAML file you
created in Project 1 Part A. It provides access to cell information
(area, timing parameters), patterns for technology mapping, and standard
cell gate classes (INVX1, NAND2X1, etc.).</p>
<p>Let's create the view and database:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellFrontEndView</span><span class="o">.</span><span class="n">parse_lib</span><span class="p">(</span><span class="s2">&quot;../../stdcells/stdcells-fe.yml&quot;</span><span class="p">)</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyFrontEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span></code></pre></div>
<p>The database supports visualizing its contents through a GUI. Enable the
GUI with:</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span></code></pre></div>
The GUI window will open. </p>
<p><img alt="" src="../img/lab3-gui-blank.png" /></p>
<p>Now add inputs, outputs, and set a tree:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">add_inports</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">add_outports</span><span class="p">([</span><span class="s2">&quot;out&quot;</span><span class="p">])</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">set_tree</span><span class="p">(</span><span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">AND2</span><span class="p">(</span><span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">))</span>
</span></code></pre></div>
<p>Watch the GUI update to show your tree when you call <code>db.set_tree(...)</code>.</p>
<p><img alt="" src="../img/lab3-gui-simple.png" /></p>
<p>In the visualization above, you will only see primary inputs, primary outputs, and generic gates. The GUI uses the following visual conventions:</p>
<ul>
<li><strong>Green ovals:</strong> Primary inputs</li>
<li><strong>Orange ovals:</strong> Wire signals</li>
<li><strong>Blue ovals:</strong> Primary outputs</li>
<li><strong>Grey rectangles:</strong> Generic gates</li>
<li><strong>Red rectangles:</strong> Standard cell gates</li>
</ul>
<p><img alt="" src="../img/lab3-gui-types.png" /></p>
<p>Once you are done with the GUI, you can exit the REPL by calling <code>exit()</code> or pressing Ctrl-D.</p>
<h2 id="3-synthesis-algorithms">3. Synthesis Algorithms</h2>
<p>In this section we will implement a couple of algorithms that will warm
you up for writing recursive functions and will be useful for Project 1
Part B. By the end of this lab, you will have a working naive technology
mapping implementation that does the job but may not guarantee minimal area cost.</p>
<h3 id="31-verilog-parser">3.1. Verilog Parser</h3>
<p>The first step of our synthesis flow is parsing. The parser lexes the
simple Verilog syntax, forms an Abstract Syntax Tree (AST), and performs
"forresting" to translate the AST into the forests of logic trees used in
TinyFlow.</p>
<p>In this part, we will be discussing the limitations of verilog we can write
for the TinyFlow. This limitation is mainly pedagogical to simplify the flow as well as limitations due to our parser (this does not mean our parser is not good).</p>
<p><strong>Rules:</strong></p>
<ol>
<li>Only Combinational Verilog</li>
<li>Only Use <code>wire</code> keyword instead of <code>logic</code></li>
<li>Only Gate level modeling. However NOT using the gate primitives like <code>and(), or(), not()</code> instead we will be using <code>assign</code> statements with operators: <code>&amp;, |, ~, ^</code>.</li>
<li>No hierarchy, every module is flat.</li>
<li>No multibit wires. So you cannot declare something like <code>wire[7:0] foo</code> you need something like
    <div class="language-verilog highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kt">wire</span><span class="w"> </span><span class="n">foo0</span><span class="p">;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kt">wire</span><span class="w"> </span><span class="n">foo1</span><span class="p">;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="p">...</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="kt">wire</span><span class="w"> </span><span class="n">foo7</span><span class="p">;</span>
</span></code></pre></div></li>
<li>Limitations on ports. Note this is a limitation for the physical tapeout
and we will communicate with you the number of input and output pins your
module will get.</li>
</ol>
<p>If you are ever confused take a look at the Lark grammar that we use to see what our parser should parse.</p>
<p>The database includes a method to read in Verilog by passing the path to
the Verilog file:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellFrontEndView</span><span class="o">.</span><span class="n">parse_lib</span><span class="p">(</span><span class="s2">&quot;../../stdcells/stdcells-fe.yml&quot;</span><span class="p">)</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyFrontEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s2">&quot;../../rtl/FullAdder.v&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Watch the GUI update to show the parsed trees.</p>
<h3 id="32-printing-trees">3.2. Printing Trees</h3>
<p>Before we implement more complex algorithms, let's warm up with a simple
recursive function. Implement <code>print_tree(node, indent=0)</code> in
<code>synth/print_tree.py</code> that prints a tree structure to the terminal. The
function should recursively visit a node and its children, passing along
the indentation level. At each node, print the indent amount of spaces
first, then the node type (accessible via <code>node.type</code>). <code>Signal</code> nodes are
leaf nodes and should print their name. For example, given
<code>AND2(OR2(Signal("a"), Signal("b")), Signal("c"))</code>, it should print:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>AND2
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a> OR2
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>  a
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>  b
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a> c
</span></code></pre></div>
<p>Open the <code>synth/print_tree.py</code> file:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab3/tinyflow
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>%<span class="w"> </span>code<span class="w"> </span>synth/print_tree.py
</span></code></pre></div>
<p>Here are some hints: The function takes a <code>node</code> and an <code>indent</code> level. First, print the
indentation (one space per indent level). Then check if the node is a
Signal (with <code>.is_signal()</code>): if so, print its name; otherwise, print the node's type and
recursively call <code>print_tree</code> on each child with <code>indent + 1</code>.</p>
<p>Once you are done with your implementation, test your function in the REPL:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">AND2</span><span class="p">(</span><span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">print_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">XOR2</span><span class="p">(</span><span class="n">AND2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">OR2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">print_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="33-matching-trees">3.3. Matching Trees</h3>
<p>Building on the spirt of recursively travering trees, we now implement <code>match(n_node, p_node)</code> which compares two trees and returns <code>True</code> if they match, <code>False</code> otherwise.
This function takes a node tree <code>n_node</code> and a pattern tree <code>p_node</code>.</p>
<p>Here we introduce a new type of node called <code>Wildcard</code>. A wildcard matches
any subtree. For example, the pattern <code>AND2(_a, _b)</code> matches <code>AND2(x, y)</code>,
<code>AND2(OR2(a, b), c)</code>, or any other AND2 tree regardless of its children.
The REPL provides predefined wildcards <code>_a</code>, <code>_b</code>, <code>_c</code>, <code>_d</code> for
convenience. In this <code>match</code> function, you can assume only the pattern tree
<code>p_node</code> can contain wildcards.</p>
<p>Open <code>synth/substitute.py</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab3/tinyflow
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>%<span class="w"> </span>code<span class="w"> </span>synth/substitute.py
</span></code></pre></div>
<p>Here are some hints: The function traverses both trees together. First,
check if <code>p_node</code> is a wildcard (using <code>.is_wildcard()</code>): if so, return
<code>True</code> because wildcards match anything. Then compare <code>p_node</code> and <code>n_node</code>:
if they are different (using <code>!=</code>), return <code>False</code>. These are the base
cases. For the recursive case, maintain a match state (to track whether all
children match) and iterate through both nodes' children together (using
<code>zip</code>). Recursively compare each pair of children and accumulate the
results for whether children match. Return the final match result.</p>
<p>Test your implementation in the REPL:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">match</span><span class="p">(</span><span class="n">AND2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">AND2</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">))</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kc">True</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">match</span><span class="p">(</span><span class="n">AND2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">OR2</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">))</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="kc">False</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">match</span><span class="p">(</span><span class="n">AND2</span><span class="p">(</span><span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">),</span> <span class="n">AND2</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">))</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="kc">True</span>
</span></code></pre></div>
<h3 id="34-capturing-subtrees">3.4. Capturing Subtrees</h3>
<p>Now that we can recursively compare two trees, we want to also capture
whatever the wildcards in the pattern tree match to. The captures should be
a dictionary mapping the wildcard name to the subtree it matched. For
example, matching <code>AND2(OR2(a, b), c)</code> against pattern <code>AND2(_a, _b)</code>
produces <code>{"a": OR2(a, b), "b": c}</code>.</p>
<p>Implement <code>capture(n_node, p_node)</code> which is similar to <code>match</code> but returns
a dictionary instead of <code>True</code>/<code>False</code>. Here we can assume that <code>n_node</code>
and <code>p_node</code> already match (you should call <code>match</code> first before calling
<code>capture</code>).</p>
<p>Open <code>synth/substitute.py</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab3/tinyflow
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>%<span class="w"> </span>code<span class="w"> </span>synth/substitute.py
</span></code></pre></div>
<p>Here are some hints: Similar to <code>match</code>, first check if <code>p_node</code> is a
wildcard. If so, return a dictionary with just the wildcard's name mapped
to <code>n_node</code>. Otherwise, recursively call <code>capture</code> on both nodes' children
(using <code>zip</code>) and merge the results. You can use <code>|=</code> to merge dictionaries.</p>
<p>Test your implementation in the REPL:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="n">AND2</span><span class="p">(</span><span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">AND2</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="k">if</span> <span class="n">match</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>              <span class="o">&gt;</span>     <span class="n">captures</span> <span class="o">=</span> <span class="n">capture</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>              <span class="o">&gt;</span>     <span class="nb">print</span><span class="p">(</span><span class="n">captures</span><span class="p">)</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">}</span>
</span></code></pre></div>
<h3 id="35-replacing-trees">3.5. Replacing Trees</h3>
<p>Now that we can match and capture subtrees, we want to build a new tree
using the captured values. Implement <code>replace(t_node, captures)</code> which
takes a template tree <code>t_node</code> (containing wildcards) and the captures
dictionary, and returns a new tree with wildcards replaced by their
corresponding captured subtrees.</p>
<p>Open <code>synth/substitute.py</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab3/tinyflow
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>%<span class="w"> </span>code<span class="w"> </span>synth/substitute.py
</span></code></pre></div>
<p>Here are some hints: The goal is to return a node, and the parent call
updates its children with what each recursive call returns. In each call we check if
<code>t_node</code> is a wildcard: if so, return the corresponding captured subtree
instead of the wildcard. Otherwise, recursively call <code>replace</code> on each
child, collect the results into a new children list, update
<code>t_node.children</code>, and return <code>t_node</code>.</p>
<p>Test your implementation in the REPL:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="n">AND2</span><span class="p">(</span><span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">AND2</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">INV</span><span class="p">(</span><span class="n">NAND2</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">))</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="k">if</span> <span class="n">match</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>              <span class="o">&gt;</span>     <span class="n">captures</span> <span class="o">=</span> <span class="n">capture</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>              <span class="o">&gt;</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">captures</span><span class="p">)</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>              <span class="o">&gt;</span>     <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="n">INV</span><span class="p">(</span><span class="n">NAND2</span><span class="p">(</span><span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">))</span>
</span></code></pre></div>
<h3 id="36-substitution">3.6. Substitution</h3>
<p>Now that we have implemented <code>match</code> (to check if a tree matches a
pattern), <code>capture</code> (to extract the subtrees that wildcards match), and
<code>replace</code> (to build a new tree using captured subtrees), we have the core
implementation for substitution in TinyFlow's frontend.</p>
<p>Substitution is one of the core functionalities that enables the synthesis
flow. In the standard cell frontend view, each standard cell defines
patterns that describe how generic gates map to that cell. The view
captures these patterns as <code>Substitute</code> objects that can be applied to
trees in the database.</p>
<p>The <code>Substitute</code> class is a container that holds a find pattern and a
replace template. Go ahead and implement the <code>apply</code> method which combines
<code>match</code>, <code>capture</code>, and <code>replace</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>  <span class="c1"># if match, capture and replace; otherwise return None</span>
</span></code></pre></div>
<p>Test your implementation in the REPL:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">),</span> <span class="n">Signal</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">sub</span> <span class="o">=</span> <span class="n">Substitute</span><span class="p">(</span><span class="n">find</span><span class="o">=</span><span class="n">AND2</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="n">INV</span><span class="p">(</span><span class="n">NAND2</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)))</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">AND2</span><span class="p">(</span><span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">))</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="n">INV</span><span class="p">(</span><span class="n">NAND2</span><span class="p">(</span><span class="n">OR2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">))</span>
</span></code></pre></div>
<h3 id="37-naive-technology-mapping">3.7. Naive Technology Mapping</h3>
<p>In Project 1 Part B you will implement an optimized version of technology
mapping. For this lab, we will implement a naive version that simply
replaces each generic gate with a corresponding standard cell.</p>
<p>The idea is to use your substitution implementation to define a pattern for
each generic gate. For example, to map AND2 to NAND2X1 + INVX1:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">Substitute</span><span class="p">(</span><span class="n">find</span><span class="o">=</span><span class="n">AND2</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">INVX1</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">NAND2X1</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)))</span>
</span></code></pre></div>
<p>Note that you can access standard cell classes directly from the view using
<code>view.INVX1</code>, <code>view.NAND2X1</code>, etc.</p>
<p>Implement <code>techmap_unopt</code> in <code>synth/techmap_unopt.py</code>. The function takes
the database and view as arguments:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">techmap_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></code></pre></div>
<p>First, we will need to define substitution rules for each generic gate type
(AND2, OR2, NOT, INV, BUF):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">rules</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>  <span class="n">Substitute</span><span class="p">(</span><span class="n">find</span><span class="o">=</span><span class="n">AND2</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">INVX1</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">NAND2X1</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">))),</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>  <span class="n">Substitute</span><span class="p">(</span><span class="n">find</span><span class="o">=...</span><span class="p">,</span> <span class="n">replace</span><span class="o">=...</span><span class="p">)</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>  <span class="c1"># ... add rules for XOR2, NOT, INV, BUF</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="p">]</span>
</span></code></pre></div>
<p>Next, implement an <code>apply_rules</code> helper function that recursively applies
rules bottom-up. The key insight is that we must transform children first
before transforming the current node. This ensures that when we match a
pattern at a node, its children have already been mapped to standard cells.
The function should: (1) return immediately for Signal nodes (base case),
(2) recursively apply rules to all children first, (3) iterate through all
rules and try each one on the current node - return the result as soon as
a rule matches (first match wins), (4) return the node unchanged if no
rules match.</p>
<p>Finally, iterate through all trees in the database and apply the rules:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">trees</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>  <span class="n">tree</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>  <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="n">new_tree</span> <span class="o">=</span> <span class="n">apply_rules</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>    <span class="n">db</span><span class="o">.</span><span class="n">set_tree</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">new_tree</span><span class="p">)</span>
</span></code></pre></div>
<p>Test your implementation with the REPL and GUI. After running techmap, the
grey generic gates should become red standard cell gates:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellFrontEndView</span><span class="o">.</span><span class="n">parse_lib</span><span class="p">(</span><span class="s2">&quot;../../stdcells/stdcells-fe.yml&quot;</span><span class="p">)</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyFrontEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s2">&quot;../../rtl/FullAdder.v&quot;</span><span class="p">)</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">synth</span><span class="o">&gt;</span> <span class="n">techmap_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="4-the-frontend-flow">4. The Frontend Flow</h2>
<p>As discussed in lecture, the frontend is more than just synthesis. The
frontend flow consists of four stages: two-state simulation, four-state
simulation, synthesis, and fast-functional gate-level simulation. As
paranoid ASIC engineers, we verify our design at each step. We simulate
the RTL before synthesis to catch design bugs early, then simulate the
gate-level netlist after synthesis to ensure the transformation preserved
functionality.</p>
<h3 id="41-two-state-rtl-simulation">4.1 Two-State RTL Simulation</h3>
<p>To ensure functionality, the first step is to verify our design quickly
using two-state simulation. Two-state simulation tests only logic values
1 and 0 to ensure basic logic correctness. In this part we will use
Verilator to perform two-state simulation.</p>
<p>In this lab we will verify a Full Adder design. We provide the Verilog RTL
in <code>rtl/FullAdder.v</code> and a basic testbench in <code>rtl/test/FullAdder-test.v</code>.
Take a look at both files to understand the design and test structure.</p>
<p>Now run the two-state simulation with Verilator:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab3/asic/build-fa/01-verilator-rtlsim
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>%<span class="w"> </span>verilator<span class="w"> </span>--top<span class="w"> </span>Top<span class="w"> </span>--timing<span class="w"> </span>--binary<span class="w"> </span>-o<span class="w"> </span>FullAdder-test<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span>../../../rtl/FullAdder.v<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span>../../../rtl/test/FullAdder-test.v
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>%<span class="w"> </span>./obj_dir/FullAdder_test
</span></code></pre></div>
<p>As discussed in lecture, two-state simulation has a limitation: unassigned
signals default to 0. This can hide bugs in your design. For example, if
you forget to assign an output, two-state simulation will silently use 0
instead of flagging an error.</p>
<p>Try this experiment: comment out the <code>assign g = a &amp; b;</code> line in your Full
Adder and re-run the simulation. Notice that <code>g</code> silently takes the value
0 instead of producing an error. This is why we need four-state simulation
in the next step. Change the code back before continuing.</p>
<h3 id="42-four-state-rtl-simulation">4.2 Four-State RTL Simulation</h3>
<p>Four-state simulation uses four logic values: 0, 1, X (unknown), and Z
(high impedance). You get X when a signal is uninitialized, when multiple
drivers are fighting (contention), or through propagation of uncertainty
(X propagates through logic). You get Z when a wire is floating (nothing
is driving it) or from a tri-stated output.</p>
<p>We use four-state simulation to capture these bugs. It is slower than
two-state simulation, but it narrows down our issue search space. If your
design passes two-state but fails four-state, the problem is usually
related to X propagation or uninitialized signals.</p>
<p>Go ahead and run the four-state simulation with Icarus Verilog:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab3/asic/build-fa/02-iverilog-rtlsim
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>%<span class="w"> </span>iverilog<span class="w"> </span>-g2012<span class="w"> </span>-I<span class="w"> </span>../../../rtl<span class="w"> </span>-o<span class="w"> </span>FullAdder-test<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span>../../../rtl/test/FullAdder-test.v
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>%<span class="w"> </span>./FullAdder-test
</span></code></pre></div>
<p>Now try the same experiment: comment out the <code>assign g = a &amp; b;</code> line and
re-run the simulation. This time you should see the simulation catch the
error because <code>g</code> becomes X instead of silently defaulting to 0. Change
the code back before continuing.</p>
<h3 id="43-synthesis">4.3 Synthesis</h3>
<p>Now that we have rigorously tested our Verilog design, we are ready to
synthesize it into a gate-level netlist. For this step, we will use the
batch processing mode of <code>tinyflow-synth</code> instead of the REPL mode we have
previous used. The batch mode takes a run script that describes the synthesis
steps.</p>
<p>Go ahead and edit the run script:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab3/asic/build-fa/03-tinyflow-synth
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>%<span class="w"> </span>code<span class="w"> </span>run.py
</span></code></pre></div>
<p>Populate the script with the commands to perform technology mapping:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">view</span> <span class="o">=</span> <span class="n">StdCellFrontEndView</span><span class="o">.</span><span class="n">parse_lib</span><span class="p">(</span><span class="s2">&quot;../../../stdcells/stdcells-fe.yml&quot;</span><span class="p">)</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">db</span> <span class="o">=</span> <span class="n">TinyFrontEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s2">&quot;../../../rtl/FullAdder.v&quot;</span><span class="p">)</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="n">techmap_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="n">db</span><span class="o">.</span><span class="n">write_verilog</span><span class="p">(</span><span class="s2">&quot;post-synth.v&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Now run the synthesis:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>%<span class="w"> </span>../../../tinyflow/tinyflow-synth<span class="w"> </span>-f<span class="w"> </span>run.py
</span></code></pre></div>
<p>This outputs the <code>post-synth.v</code> file. Open it and have a look. You should
see that all gates are now standard cells from your library, and the
module still has the same inputs and outputs as the original RTL.</p>
<h3 id="44-fast-functional-gate-level-simulation">4.4 Fast-Functional Gate-Level Simulation</h3>
<p>Now that we have our synthesized design, as paranoid ASIC engineers we
want to double check that the synthesized design still does what we
intended. Synthesis tools may not always be correct! To verify this, we
perform fast-functional gate-level simulation (FFGL), which is four-state
simulation using the same testbench but with the synthesized design and
the behavioral view of the standard cells.</p>
<p>First, copy over your <code>stdcells.v</code> from your project directory to the lab3
stdcells directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>%<span class="w"> </span>cp<span class="w"> </span><span class="nv">$HOME</span>/ece6745/project1-groupXX/stdcells/stdcells.v<span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab3/stdcells/
</span></code></pre></div>
<p>Now run the fast-functional gate-level simulation:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab3/asic/build-fa/04-iverilog-ffglsim
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>%<span class="w"> </span>iverilog<span class="w"> </span>-g2012<span class="w"> </span>-o<span class="w"> </span>FullAdder-test<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span>../../../stdcells/stdcells.v<span class="w"> </span>../03-tinyflow-synth/post-synth.v<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span>../../../rtl/test/FullAdder-test.v
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>%<span class="w"> </span>./FullAdder-test
</span></code></pre></div>
<p>If the simulation passes, your synthesized design is functionally correct.</p>
<h3 id="45-exercise-design-a-decoder">4.5 Exercise: Design a Decoder</h3>
<p>You have now walked through the frontend flow with the Full Adder. For the
final part of this lab, design your own module from scratch. Implement a
simple 2-to-4 decoder and push it through the complete four-step flow. </p>
<p>First, create the build directory structure:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>%<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab3/asic/build-decoder
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab3/asic/build-decoder
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>%<span class="w"> </span>mkdir<span class="w"> </span><span class="m">01</span>-verilator-rtlsim<span class="w"> </span><span class="m">02</span>-iverilog-rtlsim<span class="w"> </span><span class="m">03</span>-tinyflow-synth<span class="w"> </span><span class="m">04</span>-iverilog-ffglsim
</span></code></pre></div>
<p>Next, write the Verilog RTL for your decoder:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab3/rtl
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>%<span class="w"> </span>code<span class="w"> </span>Decoder.v
</span></code></pre></div>
<p>Then write a testbench for your decoder:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab3/rtl/test
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>%<span class="w"> </span>code<span class="w"> </span>Decoder-test.v
</span></code></pre></div>
<p>Now run through the four-step frontend flow, referring back to sections
4.1-4.4 for the commands. Remember to update the file paths to use your
decoder files instead of the Full Adder files.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Christopher Batten
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../js/extras.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/skins/default.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/wavedrom.min.js"></script>
      
        <script src="../js/wavedrom_loader.js"></script>
      
    
  </body>
</html>