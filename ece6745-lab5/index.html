
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Christopher Batten">
      
      
      
        <link rel="prev" href="../ece6745-lab4/">
      
      
        <link rel="next" href="../ece6745-project1a/">
      
      
        
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Lab 5: TinyRV2 Accelerators - ECE 6745 Complex Digital ASIC Design</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ece-6745-lab-5-tinyrv2-accelerators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ECE 6745 Complex Digital ASIC Design" class="md-header__button md-logo" aria-label="ECE 6745 Complex Digital ASIC Design" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ECE 6745 Complex Digital ASIC Design
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 5: TinyRV2 Accelerators
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/cornell-ece6745/ece6745-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    cornell-ece6745/ece6745-mkdocs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ece6745-tut00-remote-access/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ece6745-lab1/" class="md-tabs__link">
          
  
  
  Labs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ece6745-project1a/" class="md-tabs__link">
          
  
  
  Projects

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ece6745-tinyflow-180nm-drm/" class="md-tabs__link">
          
  
  
  Misc

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ECE 6745 Complex Digital ASIC Design" class="md-nav__button md-logo" aria-label="ECE 6745 Complex Digital ASIC Design" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ECE 6745 Complex Digital ASIC Design
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cornell-ece6745/ece6745-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    cornell-ece6745/ece6745-mkdocs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tut00-remote-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial 0: ECE Linux Server Remote Access
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tut01-linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial 1: Linux Development Environment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tut02-git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial 2: Git Distributed Version Control System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Labs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Labs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 1: Full-Custom Inverter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 2: Standard-Cell Inverter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 3: TinyFlow Front End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 4: TinyFlow Back End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Lab 5: TinyRV2 Accelerators
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 5: TinyRV2 Accelerators
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-logging-into-ecelinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Logging Into ecelinux
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-software-baseline" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Software Baseline
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-accelerator-fl-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Accelerator FL Model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-gcd-accelerator" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. GCD Accelerator
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. GCD Accelerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-stand-alone-gcd-unit" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1. Stand-Alone GCD Unit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-medium-grain-gcd-accelerator" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2. Medium-Grain GCD Accelerator
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-tinyrv2-processor-accelerator" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. TinyRV2 Processor + Accelerator
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-project-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Project 2
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Projects
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Projects
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Project 1: TinyFlow Tape-Out
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project 1: TinyFlow Tape-Out
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project1a/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part A: TinyFlow Standard Cells
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project1b/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part B: TinyFlow Front End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project1c/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part C: TinyFlow Back End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Misc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tinyflow-180nm-drm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tinyflow 180nm Design Rules Manual
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project2-ideas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project 2 Ideas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-logging-into-ecelinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Logging Into ecelinux
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-software-baseline" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Software Baseline
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-accelerator-fl-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Accelerator FL Model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-gcd-accelerator" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. GCD Accelerator
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. GCD Accelerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-stand-alone-gcd-unit" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1. Stand-Alone GCD Unit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-medium-grain-gcd-accelerator" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2. Medium-Grain GCD Accelerator
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-tinyrv2-processor-accelerator" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. TinyRV2 Processor + Accelerator
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-project-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Project 2
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="ece-6745-lab-5-tinyrv2-accelerators">ECE 6745 Lab 5: TinyRV2 Accelerators</h1>
<p>In this lab, we will be discussing how to implement a simple medium-grain
accelerator. Fine-grain accelerators are tightly integrated within the
processor pipeline (e.g., a specialized functional unit for bit-reversed
addressing useful in implementing an FFT), while coarse-grain
accelerators are loosely integrated with a processor through the memory
hierarchy (e.g., a graphics rendering accelerator sharing the last-level
cache with a general-purpose processor). Medium-grain accelerators are
often integrated as co-processors: the processor can directly
send/receive messages to/from the accelerator with special instructions,
but the co-processor is relatively decoupled from the main processor
pipeline and can also potentially independently interact with memory.</p>
<p>This diagram illustrates a system architecture where the accelerator
<em>can</em> independently interact with memory.</p>
<p><img alt="" src="../img/lab5-proc-xcel-with-mem.png" /></p>
<p>While this diagram illustrates a system architecture where the
accelerator <em>cannot</em> independently interact with memory; the processor is
responsible for moving data between memory and the accelerator.</p>
<p><img alt="" src="../img/project2-proc-xcel.png" /></p>
<p>While project 3 can explore accelerators with their own memory interface,
project 2 will only explore accelerators without an independent memory
interface.</p>
<p>To illustrate how to implement a medium-grain accelerator, we will be
working on a simple GCD accelerator that calculates the greatest common
divisor of two 15-bit integers. Essentially, we will be exploring the
stand-alone GCD unit you saw in Tutorial 4 and turn it into an
accelerator which can be composed with a processor.</p>
<ul>
<li><a href="https://web.csl.cornell.edu/courses/ece6745/handouts/ece6745-tut3-verilog.pdf">https://web.csl.cornell.edu/courses/ece6745/handouts/ece6745-tut3-verilog.pdf</a></li>
</ul>
<h2 id="1-logging-into-ecelinux">1. Logging Into <code>ecelinux</code></h2>
<p>Follow the same process as previous labs. Find a free workstation and log
into the workstation using your NetID and standard NetID password. Then
complete the following steps.</p>
<ul>
<li>Start VS Code</li>
<li>Install the Remote-SSH extension, Surfer, Python, and Verilog extensions</li>
<li>Use View &gt; Command Palette to execute Remote-SSH: Connect Current Window to Host...</li>
<li>Enter netid@ecelinux-XX.ece.cornell.edu where XX is an ecelinux server number</li>
<li>Use View &gt; Explorer to open your home directory on ecelinux</li>
<li>Use View &gt; Terminal to open a terminal on ecelinux</li>
<li>Start MS Remote Desktop</li>
</ul>
<p>Now use the following commands to clone the repo we will be using for
today's lab.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>%<span class="w"> </span><span class="nb">source</span><span class="w"> </span>setup-ece6745.sh
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>%<span class="w"> </span><span class="nb">source</span><span class="w"> </span>setup-gui.sh
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>%<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>%<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:cornell-ece6745/ece6745-lab5<span class="w"> </span>lab5
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>lab5
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>%<span class="w"> </span>tree
</span></code></pre></div>
<p>To make it easier to cut-and-paste commands from this handout onto the
command line, you can tell Bash to ignore the <code>%</code> character using the
following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>%<span class="w"> </span><span class="nb">alias</span><span class="w"> </span>%<span class="o">=</span><span class="s2">&quot;&quot;</span>
</span></code></pre></div>
<p>Now you can cut-and-paste a sequence of commands from this tutorial
document and Bash will not get confused by the <code>%</code> character which begins
each line.</p>
<h2 id="3-software-baseline">3. Software Baseline</h2>
<p>Before implementing any kind of accelerator, we first need to implement a
software version both to explore the algorithm and to create a baseline
for comparative analysis. Our goal is to develop an accelerator which
improves the performance compared to an equivalent software version; if
our accelerator is slower then we are better off using a software
implementation!</p>
<p>Start the Python interpreter and experiment with Python's provided GCD
function.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>% cd ${HOME}/ece6745/lab5
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>% python
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>&gt;&gt;&gt; import math
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>&gt;&gt;&gt; math.gcd( 15,  5 )
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>&gt;&gt;&gt; math.gcd( 21, 49 )
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>&gt;&gt;&gt; math.gcd( 13,  7 )
</span></code></pre></div>
<p>Now write your own GCD implementation using Euclid's algorithm.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span><span class="w"> </span><span class="nf">gcd</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">):</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="o">...</span>   <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="o">...</span>     <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">:</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="o">...</span>       <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span><span class="n">a</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="o">...</span>     <span class="k">elif</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="o">...</span>       <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="o">...</span>     <span class="k">else</span><span class="p">:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="o">...</span>       <span class="k">return</span> <span class="n">a</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="o">...</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">gcd</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">gcd</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">39</span><span class="p">)</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">gcd</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</span></code></pre></div>
<p>Once you understand the algorithm, now we can impement the algorithm in C
to serve as a baseline for comparative analysis. Use VS Code to open up
the <code>ubmark-gcd.c</code> file.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/ubmark
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>%<span class="w"> </span>code<span class="w"> </span>ubmark-gcd.c
</span></code></pre></div>
<p>Go ahead and write a C version of GCD using your Python algorithm for
reference. Now we want to rigorously test our C baseline. Take a look at
the provided C <em>test program</em>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/ubmark
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>%<span class="w"> </span>code<span class="w"> </span>ubmark-gcd-test.c
</span></code></pre></div>
<p>The C test program includes a number of test cases and then a main
function with runs the test cases.</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">test_case_1_basic</span><span class="p">()</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="n">ECE6745_CHECK</span><span class="p">(</span><span class="w"> </span><span class="sa">L</span><span class="s">&quot;test_case_1_basic&quot;</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ubmark_gcd</span><span class="p">(</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">  </span><span class="n">ECE6745_CHECK_INT_EQ</span><span class="p">(</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="p">}</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="p">...</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="p">{</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">  </span><span class="n">__n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">argc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ece6745_atoi</span><span class="p">(</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">__n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">__n</span><span class="w"> </span><span class="o">==</span><span class="w">  </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">test_case_1_basic</span><span class="p">();</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">  </span><span class="p">...</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">  </span><span class="n">ece6745_wprintf</span><span class="p">(</span><span class="w"> </span><span class="sa">L</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ece6745_check_status</span><span class="p">;</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>Note that our TinyRV2 processor does not support any kind of operating
system or even any kind of C library. It is essentially a bare-metal
micro-controller. You will need to implement or port all libraries
yourself. We provide you a few very simple library functions in
<code>app/ece6745</code>:</p>
<ul>
<li><code>ece6745_atoi</code>: converts strings to integers</li>
<li><code>ece6745_wprintf</code>: very simple printf for 4B-character strings</li>
<li><code>ece6745_malloc</code>: very simple bump-pointer malloc</li>
<li><code>ece6745_free</code>: basically does nothing</li>
<li><code>ece6745_srand</code>: set the random seed</li>
<li><code>ece6745_rand</code>: return random integer</li>
<li><code>ece6745_exit</code>: exit the program</li>
</ul>
<p>TinyRV2 does not support load byte or store byte so all characters must
be four bytes. You can indicate a four-byte character string by using the
L prefix.</p>
<p>Let's go ahead and compile the C test program natively and ensure our
implementation is functionally correct. Note that we will be using two
different compilation flows:</p>
<ul>
<li>
<p><strong>Native compilation:</strong> Compile C programs for x86 and run them
   directly on the server</p>
</li>
<li>
<p><strong>Cross compilation:</strong> Compile C programs for TinyRV2 and run them
   on a functional-level or RTL simulator</p>
</li>
</ul>
<p>Each compilation flow will have its own build directory.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>%<span class="w"> </span>mkdir<span class="w"> </span>build-native
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build-native
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>%<span class="w"> </span>../configure
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>%<span class="w"> </span>make<span class="w"> </span>ubmark-gcd-test
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>%<span class="w"> </span>./ubmark-gcd-test
</span></code></pre></div>
<p>You can run a specific test case as follows:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build-native
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>%<span class="w"> </span>./ubmark-gcd-test<span class="w"> </span><span class="m">1</span>
</span></code></pre></div>
<p>Test programs are used to ensure functional correctness. They are not
used to evaluate performance. We will always use a seperate evaluation
program to evaluate performance. Go ahead and take a look at the provided
C <em>evaluation program</em>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/ubmark
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>%<span class="w"> </span>code<span class="w"> </span>ubmark-gcd-eval.c
</span></code></pre></div>
<p>The C evaluation program includes a region-of-interest (ROI) and
verification code.</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="p">{</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="c1">// Allocate destination array for results</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ece6745_malloc</span><span class="p">(</span><span class="w"> </span><span class="n">eval_size</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">  </span><span class="c1">// Run the evaluation</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">  </span><span class="n">ece6745_stats_on</span><span class="p">();</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">eval_size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ubmark_gcd</span><span class="p">(</span><span class="w"> </span><span class="n">eval_a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">eval_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">  </span><span class="n">ece6745_stats_off</span><span class="p">();</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">  </span><span class="c1">// Verify the results</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">eval_size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eval_ref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">      </span><span class="n">ece6745_wprintf</span><span class="p">(</span><span class="w"> </span><span class="sa">L</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> FAILED: dest[%d] != eval_ref[%d] (%d != %d)</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">                       </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">dest</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">eval_ref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">      </span><span class="n">ece6745_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="w">  </span><span class="c1">// Free destination array</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="w">  </span><span class="n">ece6745_free</span><span class="p">(</span><span class="n">dest</span><span class="p">);</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="w">  </span><span class="c1">// Check for no memory leaks</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ece6745_get_heap_usage</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="w">    </span><span class="n">ece6745_wprintf</span><span class="p">(</span><span class="w"> </span><span class="sa">L</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> FAILED: memory leak of %d bytes!</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="w">                     </span><span class="n">ece6745_get_heap_usage</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="w">    </span><span class="n">ece6745_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="w">  </span><span class="c1">// Otherwise we passed</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="w">  </span><span class="n">ece6745_wprintf</span><span class="p">(</span><span class="w"> </span><span class="sa">L</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> **PASSED** </span><span class="se">\n\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a><span class="p">}</span>
</span></code></pre></div>
<p>Take a look at the <code>ece6745_stats_on</code> and <code>ece6745_stats_off</code> function
calls in <code>app/ece6745/ece6745-misc.h</code>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/ece6745
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>%<span class="w"> </span>code<span class="w"> </span>ece6745-misc.c
</span></code></pre></div>
<p>These functions simply use <em>inline assembly</em> to insert CSR write
instructions to write a special CSR which tells the hardware when to
start and stop collecting statistics. All of this is very similar to what
you saw in ECE 4750.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>#ifdef _RISCV
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>inline
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>void ece6745_stats_on()
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>{
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>  int status = 1;
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>  __asm__ ( &quot;csrw 0x7c1, %0&quot; :: &quot;r&quot;(status) );
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>}
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>#else
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>inline
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>void ece6745_stats_on()
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>{ }
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>#endif
</span></code></pre></div>
<p>We use the <code>_RISCV</code> preprocessor define to make sure that when we compile
this functional natively it is empty, but when we cross-compile it we
insert the desired CSRW instruction.</p>
<p>Lets compile and run the evaluation program natively.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build-native
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>%<span class="w"> </span>make<span class="w"> </span>ubmark-gcd-eval
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>%<span class="w"> </span>./ubmark-gcd-eval
</span></code></pre></div>
<p>If everything is working we can now test out our GCD software baseline on
the TinyRV1 processor. First we need to cross-compile the GCD function in
a different build directory. Let's also go ahead and look at the
corresponding TinyRV2 assembly.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>%<span class="w"> </span>mkdir<span class="w"> </span>build
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>%<span class="w"> </span>../configure<span class="w"> </span>--host<span class="o">=</span>riscv64-unknown-elf
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>%<span class="w"> </span>make<span class="w"> </span>ubmark-gcd.o
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>%<span class="w"> </span>tinyrv2-objdump<span class="w"> </span>ubmark-gcd.o
</span></code></pre></div>
<p>Note that we have not linked the object file yet so addresses are
relative to the start of this function. Spend some time seeing if you can
connect the assembly to the C code you write. Now let's cross-compiler
the entire test program and again look at the GCD function.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>%<span class="w"> </span>make<span class="w"> </span>ubmark-gcd-test
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>%<span class="w"> </span>tinyrv2-objdump<span class="w"> </span>ubmark-gcd-test<span class="w"> </span><span class="p">|</span><span class="w"> </span>less<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;&lt;ubmark_gcd&gt;:&quot;</span>
</span></code></pre></div>
<p>Notice that we have now linked the program so the addresses are global
addresses in the context of the entire program.</p>
<p>We can run this test program on a functional-level (FL) model of the
TinyRV2 processor just like you did in ECE 4750. An FL model of a
processor is sometimes called an "ISA simulator" since it just simulates
the ISA and does not model any of the microarchitecture.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>./ubmark-gcd-test
</span></code></pre></div>
<p>The output should look exactly the same as the native execution, but of
course now we are simulating thousands or TinyRV1 instructions. Use the
<code>--trace</code> command line option to watch these instructions being executed.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--trace<span class="w"> </span>./ubmark-gcd-test
</span></code></pre></div>
<p>Let's also verify that our evaluation program runs correctly on the ISA
simulator.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>%<span class="w"> </span>make<span class="w"> </span>ubmark-gcd-eval
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>./ubmark-gcd-eval
</span></code></pre></div>
<p>Let's save the disassembly of the evaluation program for future
reference.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>%<span class="w"> </span>tinyrv2-objdump<span class="w"> </span>ubmark-gcd-eval<span class="w"> </span>&gt;<span class="w"> </span>ubmark-gcd-eval.dump
</span></code></pre></div>
<p>We are now finally ready to run test and evaluate the GCD software
baseline on the RTL implementation. Recall that the five-stage TinyRV2
processor pipeline datapath looks like this:</p>
<p><img alt="" src="../img/tut09-proc-dpath.png" /></p>
<p>Let's start by looking at a version of the system with no caches before
seeing the impact of adding an instruction and data cache.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>./ubmark-gcd-test
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>./ubmark-gcd-eval
</span></code></pre></div>
<p>Again, the output should look the exactly the same as the native
execution and the cross-compiled execution running on the ISA simulator,
but of course now we are simulating thousands of of TinyRV2 instructions
executing on the five-stage TinyRV2 pipelined processor you implemented
in ECE 4750. Let's dig into the trace output to understand how these
instructions are executing on the pipeline.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>--trace<span class="w"> </span>./ubmark-gcd-eval<span class="w"> </span>&gt;<span class="w"> </span>ubmark-gcd-eval-nocache.trace
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>%<span class="w"> </span>code<span class="w"> </span>ubmark-gcd-eval-nocache.trace
</span></code></pre></div>
<p>Search for the first execution of the CSRW instruction. This is where we
turn on stats and thus this is where the ROI starts. You should be able
to look down and see where the GCD function starts its work. Use the
disassembly to connect the PCs in the trace with the addresses of the
instructions in the actual program. Here is an example:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>     fetch    decode                  mem  exe  wb   imem  dmem
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>271: 00000760|lw     x11, 0x000(x19) |    |    |blt  rd&gt;rd|      &gt;
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>272: 00000764|lw     x10, 0x000(x20) |lw  |    |     rd&gt;rd|rd&gt;   &gt;
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>273: 00000768|addi   x08, x08, 0x001 |lw  |lw  |     rd&gt;rd|rd&gt;rd &gt;
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>274: 0000076c|addi   x20, x20, 0x004 |addi|lw  |lw   rd&gt;rd|  &gt;rd &gt;
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>275: /       |jal    x01, 0x1ffb90   |addi|addi|lw   rd&gt;rd|      &gt;
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>276: 000002fc|                       |jal |addi|addi rd&gt;rd|      &gt;
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>277: /       |jal    x00, 0x00000c   |    |jal |addi rd&gt;rd|      &gt;
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>278: 00000308|                       |jal |    |jal  rd&gt;rd|      &gt;
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>279: 0000030c|addi   x15, x10, 0x000 |    |jal |     rd&gt;rd|      &gt;
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>280: 00000310|blt    x10, x11, 0x1ff4|addi|    |jal  rd&gt;rd|      &gt;
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>281: 00000314|beq    x11, x00, 0x000c|blt |addi|     rd&gt;rd|      &gt;
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>282: 00000318|sub    x10, x10, x11   |beq |blt |addi rd&gt;rd|      &gt;
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>283: /       |jal    x00, 0x1ffff0   |sub |beq |blt  rd&gt;rd|      &gt;
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>284: 00000308|                       |jal |sub |beq  rd&gt;rd|      &gt;
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>285: 0000030c|addi   x15, x10, 0x000 |    |jal |sub  rd&gt;rd|      &gt;
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>286: 00000310|blt    x10, x11, 0x1ff4|addi|    |jal  rd&gt;rd|      &gt;
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>287: /       |/                      |blt |addi|     rd&gt;rd|      &gt;
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>288: 00000300|                       |    |blt |addi rd&gt;rd|      &gt;
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>289: 00000304|addi   x10, x11, 0x000 |    |    |blt  rd&gt;rd|      &gt;
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>290: 00000308|addi   x11, x15, 0x000 |addi|    |     rd&gt;rd|      &gt;
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>291: 0000030c|addi   x15, x10, 0x000 |addi|addi|     rd&gt;rd|      &gt;
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>292: 00000310|blt    x10, x11, 0x1ff4|addi|addi|addi rd&gt;rd|      &gt;
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>293: 00000314|beq    x11, x00, 0x000c|blt |addi|addi rd&gt;rd|      &gt;
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>294: /       |/                      |beq |blt |addi rd&gt;rd|      &gt;
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>295: 0000031c|                       |    |beq |blt  rd&gt;rd|      &gt;
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>296: 00000320|jalr   x00, x01, 0x000 |    |    |beq  rd&gt;rd|      &gt;
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>297: /       |/                      |jalr|    |     rd&gt;rd|      &gt;
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>298: 00000770|                       |    |jalr|     rd&gt;rd|      &gt;
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>299: 00000774|sw     x10, 0x000(x18) |    |    |jalr rd&gt;rd|      &gt;
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>300: 00000778|lw     x15, 0xc70(x21) |sw  |    |     rd&gt;rd|wr&gt;   &gt;
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>301: 0000077c|addi   x19, x19, 0x004 |lw  |sw  |     rd&gt;rd|rd&gt;wr &gt;
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a>302: 00000780|addi   x18, x18, 0x004 |addi|lw  |sw   rd&gt;rd|  &gt;rd &gt;
</span></code></pre></div>
<p>You can see the instructions flowing down the pipeline. It looks like
there are maybe four iterations of the while loop. Notice how we are
squashing one instruction for a JAL and two instructions for a BEQ and
JALR. Let's go ahead and rerun the evaluation but this time with the
<code>--stats</code> command line option so we can determine the number of cycles
and instructions in the ROI.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>--stats<span class="w"> </span>./ubmark-gcd-eval
</span></code></pre></div>
<p>Real systems also include caches. We cannot directly use the non-blocking
cache you developed in ECE 4750 for two reasons. First, the ECE 4750
design has a four-cycle hit latency which would drastically reduce
performance. Second, the ECE 4750 design uses combinational-read SRAMs.
Real ASICs use synchronous-read SRAMs which means you send in the read
address on one cycle and the read data comes back the next cycle. We have
improved the ECE 4750 cache design to address both of these weaknesses.
Here is what the improved datapath looks like:</p>
<p><img alt="" src="../img/lab5-cache-dpath.png" /></p>
<p>And here is what the improved control unit looks like:</p>
<p><img alt="" src="../img/lab5-cache-ctrl.png" /></p>
<p>Let's rerun our GCD tests and evaluation program on both the processor
and cache RTL to ensure everything still works.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>--cache-impl<span class="w"> </span>rtl<span class="w"> </span>./ubmark-gcd-test
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>--cache-impl<span class="w"> </span>rtl<span class="w"> </span>./ubmark-gcd-eval
</span></code></pre></div>
<p>Let's dig into the trace output to understand how the processor and cache
interact.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>--cache-impl<span class="w"> </span>rtl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span>--trace<span class="w"> </span>./ubmark-gcd-eval<span class="w"> </span>&gt;<span class="w"> </span>ubmark-gcd-eval-cache.trace
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>%<span class="w"> </span>code<span class="w"> </span>ubmark-gcd-eval-cache.trace
</span></code></pre></div>
<p>The trace will look very different! There is a column that shows the FSM
state for instruction cache and a separate column that shows the FSM
state for the data cache. You can see the misses in the instruction cache
the first time we call the GCD function ...</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>     fetch    decode                  mem  exe  wb   I$  D$   imem  dmem
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>474: 000002fc|                       |    |    |    [MWT|I  ]      |      &gt;
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>475: /       |jal    x00, 0x00000c   |    |    |    [I  |I  ]      |      &gt;
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>476: #       |                       |jal |    |    [TC |I  ]      |      &gt;
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>477: #       |                       |    |jal |    [RRQ|I  ] rd&gt;  |      &gt;
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>478: #       |                       |    |    |jal [RWT|I  ]   &gt;rd|      &gt;
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>479: #       |                       |    |    |    [RUP|I  ]      |      &gt;
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>480: #       |                       |    |    |    [MR0|I  ]      |      &gt;
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>481: #       |                       |    |    |    [MR1|I  ]      |      &gt;
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>482: #       |                       |    |    |    [MWT|I  ]      |      &gt;
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>483: #       |                       |    |    |    [I  |I  ]      |      &gt;
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>484: 00000308|                       |    |    |    [TC |I  ]      |      &gt;
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>485: 0000030c|addi   x15, x10, 0x000 |    |    |    [TC |I  ]      |      &gt;
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>486: #       |blt    x10, x11, 0x1ff4|addi|    |    [TC |I  ]      |      &gt;
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>487: #       |                       |blt |addi|    [RRQ|I  ] rd&gt;  |      &gt;
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>488: #       |                       |    |blt |addi[RWT|I  ]   &gt;rd|      &gt;
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>489: #       |                       |    |    |blt [RUP|I  ]      |      &gt;
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>490: #       |                       |    |    |    [MR0|I  ]      |      &gt;
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>491: #       |                       |    |    |    [MR1|I  ]      |      &gt;
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>492: 00000310|                       |    |    |    [MWT|I  ]      |      &gt;
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>493: #       |beq    x11, x00, 0x000c|    |    |    [I  |I  ]      |      &gt;
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>494: /       |                       |beq |    |    [TC |I  ]      |      &gt;
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>495: 0000031c|                       |    |beq |    [TC |I  ]      |      &gt;
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>496: #       |jalr   x00, x01, 0x000 |    |    |beq [TC |I  ]      |      &gt;
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>497: /       |                       |jalr|    |    [RRQ|I  ] rd&gt;  |      &gt;
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>498: #       |                       |    |jalr|    [RWT|I  ]   &gt;rd|      &gt;
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>499: #       |                       |    |    |jalr[RUP|I  ]      |      &gt;
</span></code></pre></div>
<p>... and then later you can see the instruction cache hits.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>     fetch    decode                  mem  exe  wb   I$  D$   imem  dmem
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>584: 000002fc|                       |jal |addi|addi[TC |I  ]      |      &gt;
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>585: /       |jal    x00, 0x00000c   |    |jal |addi[TC |I  ]      |      &gt;
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>586: 00000308|                       |jal |    |jal [TC |I  ]      |      &gt;
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>587: 0000030c|addi   x15, x10, 0x000 |    |jal |    [TC |I  ]      |      &gt;
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>588: 00000310|blt    x10, x11, 0x1ff4|addi|    |jal [TC |I  ]      |      &gt;
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>589: 00000314|beq    x11, x00, 0x000c|blt |addi|    [TC |I  ]      |      &gt;
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>590: 00000318|sub    x10, x10, x11   |beq |blt |addi[TC |I  ]      |      &gt;
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>591: /       |jal    x00, 0x1ffff0   |sub |beq |blt [TC |I  ]      |      &gt;
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>592: 00000308|                       |jal |sub |beq [TC |I  ]      |      &gt;
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>593: 0000030c|addi   x15, x10, 0x000 |    |jal |sub [TC |I  ]      |      &gt;
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>594: 00000310|blt    x10, x11, 0x1ff4|addi|    |jal [TC |I  ]      |      &gt;
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>595: /       |/                      |blt |addi|    [TC |I  ]      |      &gt;
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>596: 00000300|                       |    |blt |addi[TC |I  ]      |      &gt;
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>597: 00000304|addi   x10, x11, 0x000 |    |    |blt [TC |I  ]      |      &gt;
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>598: 00000308|addi   x11, x15, 0x000 |addi|    |    [TC |I  ]      |      &gt;
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>599: 0000030c|addi   x15, x10, 0x000 |addi|addi|    [TC |I  ]      |      &gt;
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>600: 00000310|blt    x10, x11, 0x1ff4|addi|addi|addi[TC |I  ]      |      &gt;
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>601: 00000314|beq    x11, x00, 0x000c|blt |addi|addi[TC |I  ]      |      &gt;
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>602: /       |/                      |beq |blt |addi[TC |I  ]      |      &gt;
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>603: 0000031c|                       |    |beq |blt [TC |I  ]      |      &gt;
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>604: 00000320|jalr   x00, x01, 0x000 |    |    |beq [TC |I  ]      |      &gt;
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>605: /       |/                      |jalr|    |    [TC |I  ]      |      &gt;
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>606: 00000770|                       |    |jalr|    [TC |I  ]      |      &gt;
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>607: 00000774|sw     x10, 0x000(x18) |    |    |jalr[TC |I  ]      |      &gt;
</span></code></pre></div>
<p>Let's go ahead and rerun the evaluation with both the processor and
caches.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>--cache-impl<span class="w"> </span>rtl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span>--stats<span class="w"> </span>./ubmark-gcd-eval
</span></code></pre></div>
<h2 id="4-accelerator-fl-model">4. Accelerator FL Model</h2>
<p>Now that we have our software baseline we can start to explore an
accelerator that will hopefully improve the performance compared to the
software baseline. We should always build a functional-level (FL) model
of our accelerator before actually implementing the accelerator in
hardware. The FL model will enable us to develop a compelling testing
strategy and to also develop the software which interacts with the
accelerator. In this course we will write our FL models in Python using
PyMTL3.</p>
<p>Our accelerators include a set of accelerator registers that can be read
and written from the processor using special instructions and the
xcelreq/xcelresp interface. The GCD accelerator protocol defines the
accelerator registers as follows:</p>
<ul>
<li><code>xr0</code>: a (only bottom 15 bits are used)</li>
<li><code>xr1</code>: b (only bottom 15 bits are used)</li>
<li><code>xr2</code>: result (only bottom 15 bits are used)</li>
</ul>
<p>The actual protocol involves the folloing steps:</p>
<ul>
<li>Write a to xr0</li>
<li>Write b to xr1</li>
<li>Read result from xr2 (which causes the xcel to do the calculation)</li>
</ul>
<p>Take a look at the incomplete FL model in <code>sim/lab5_xcel/GcdXcelFL.py</code>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/sim/lab5_xcel
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>%<span class="w"> </span>code<span class="w"> </span>GcdXcelFL.py
</span></code></pre></div>
<p>The FL model uses a PyMTL <code>@update_once</code> block to model some hardware
which should execute once per cycle. You may need to work through
Tutorial 4 to learn more about PyMTL multi-level modeling:</p>
<ul>
<li><a href="https://web.csl.cornell.edu/courses/ece6745/handouts/ece6745-tut4-pymtl.pdf">https://web.csl.cornell.edu/courses/ece6745/handouts/ece6745-tut4-pymtl.pdf</a></li>
</ul>
<p>We have provided you code which handles the accelerator protocol. Spend a
few minutes understanding how this works. Now go ahead and use the Python
standard library <code>math.gcd</code> function to finish implementing the FL model.</p>
<p>We provide you an incomplete test bench in
<code>sim/lab5_xcel/test/GcdXcelFL_test.py</code>. Go head and take a look at this
test bench.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/sim/lab5_xcel/test
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>%<span class="w"> </span>code<span class="w"> </span>GcdXcelFL_test.py
</span></code></pre></div>
<p>This is very similar to how we did our testing in ECE 4750. You need to
implement the <code>xgcd</code> function which takes as input a, b, result and
returns a list of acceleratore request messages and the expected response
messages.</p>
<p>Once you have finished the FL model and the test bench, go ahead and use
pytest to test your FL model.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>%<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/sim/build
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>%<span class="w"> </span>pytest<span class="w"> </span>../lab5_xcel/test/GcdXcelFL_test.py<span class="w"> </span>-v
</span></code></pre></div>
<p>Notice how the FL model enables us to rigorously get all of our tests
ready before we have even started our RTL modeling. This is the key to
test-driven design. Now if our RTL model fails a test we can be
reasonable sure the test is correct and the RTL model is wrong.</p>
<p>The other benefit of an FL model is it enable us to start developing the
software that will control our accelerator right away. Software will send
messages to the accelerator by reading and writing 32 special CSRs using
the standard CSRW and CSRR instructions. These 32 special CSRs are as
follows:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>0x7e0 : accelerator register  0 (xr0)
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>0x7e1 : accelerator register  1 (xr1)
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>0x7e2 : accelerator register  2 (xr2)
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>...
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>0x7ff : accelerator register 31 (xr31)
</span></code></pre></div>
<p>Here is a simple assembly sequence which will write the value 1 to an
accelerator register, read that value back from the accelerator register,
and write the value to general-purpose register x2.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>addi x1, x0, 1
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>csrw 0x7e0, x1
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>csrr x2, 0x7e0
</span></code></pre></div>
<p>To use an accelerator from a C microbenchmark, we need to embed assembly
instructions directly into a C program. We can do this using the GCC
inline assembly extensions. Take a closer look at the accelerated version
of the GCD function in <code>app/ubmark/ubmark-gcd-xcel.c</code>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/ubmark
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>%<span class="w"> </span>code<span class="w"> </span>ubmark-gcd-xcel.c
</span></code></pre></div>
<p>The incomplete implementation looks as follows:</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="cp">#ifdef _RISCV</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">ubmark_gcd_xcel</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="p">{</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">  </span><span class="n">__asm__</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">    </span><span class="s">&quot;csrw ???, %[a];</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">    </span><span class="s">&quot;csrw ???, %[b];</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">    </span><span class="s">&quot;csrr %[result], ???;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">    </span><span class="c1">// Outputs from the inline assembly block</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">result</span><span class="p">]</span><span class="w"> </span><span class="s">&quot;=r&quot;</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">    </span><span class="c1">// Inputs to the inline assembly block</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="w">      </span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="p">}</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="cp">#else</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="kt">int</span><span class="w"> </span><span class="nf">ubmark_gcd_xcel</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a><span class="p">{</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ubmark_gcd</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a><span class="p">}</span>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a><span class="cp">#endif</span>
</span></code></pre></div>
<p>The <code>asm</code> keyword enables embedding assembly into a C program. We have a
sequence of strings, and each string is one assembly instruction. <code>%[a]</code>
is special syntax that tells GCC to put the register that holds the src C
variable into that location in the assembly. So if the compiler ends up
allocating the <code>a</code> C variable to <code>x11</code> then it will put <code>x11</code> into the
first assembly instruction. Notice how we use the non-accelerated version
for native compilation just to make sure everything works.</p>
<p>Go ahead and fill in the <code>???</code> with the correct CSRs based on the
accelerator protocol described earlier.</p>
<p>Let's cross-compile and run both our test program and evaluation program
using the FL model of the GCD accelerator.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--xcel-impl<span class="w"> </span>gcd-fl<span class="w"> </span>./ubmark-gcd-xcel-test
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--xcel-impl<span class="w"> </span>gcd-fl<span class="w"> </span>./ubmark-gcd-xcel-eval
</span></code></pre></div>
<h2 id="5-gcd-accelerator">5. GCD Accelerator</h2>
<p>We always want to use an incremental design process when implementing our
accelerator. We often create one or more stand-alone units, unit test
them, and then compose them with a manager to create the final
accelerator.</p>
<h3 id="51-stand-alone-gcd-unit">5.1. Stand-Alone GCD Unit</h3>
<p>In this case, we want to reuse the stand-alone GCD unit we developed in
Tutorial 3. Go ahead and take look at the stand-alone GCD unit.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/sim/tut3_verilog/gcd
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>%<span class="w"> </span>code<span class="w"> </span>GcdUnit.v
</span></code></pre></div>
<p>The stand-alone GCD unit uses latency insensitive interfaces and a clean
datapath/control split.</p>
<p><img alt="" src="../img/lab5-gcd.png" /></p>
<p>Let's run all the tests to make sure the stand-alone GCD unit is working.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/sim/build
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>%<span class="w"> </span>pytest<span class="w"> </span>../tut3_verilog/gcd
</span></code></pre></div>
<p>We also have a simulator for evaluating the GCD unit in isolation. You
can experiment with the simulator like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>% cd ${HOME}/ece6745/lab5/sim/build
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>% ../tut3_verilog/gcd/gcd-sim --impl rtl --trace
</span></code></pre></div>
<p>These kind of stand-alone simulators are critical for evaluating the
performance of various hardware units before turning the unit into a
medium-grain accelerator and integrating it with a processor.</p>
<h3 id="52-medium-grain-gcd-accelerator">5.2. Medium-Grain GCD Accelerator</h3>
<p>To turn the GCD unit into an accelerator, we need to compose it with a
<em>manager</em> which will handle the accelerator protocol. We have provided
you a GCD accelerator manager in <code>sim/lab5_xcel/GcdXcel.v</code>. Go ahead and
take a look this manager and how we compose it with the stand-alone GCD
unit to create the complete accelerator.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/sim/lab5_xcel
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>%<span class="w"> </span>code<span class="w"> </span>GcdXcel.v
</span></code></pre></div>
<p>To test our GCD accelerator, we can simply reuse all of the tests we
wrote to verify our GCD FL model. This is the whole point of developing
an FL model in the first place!</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/sim/build
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>%<span class="w"> </span>pytest<span class="w"> </span>../lab5_xcel/test/GcdXcel_test.py
</span></code></pre></div>
<h2 id="6-tinyrv2-processor-accelerator">6. TinyRV2 Processor + Accelerator</h2>
<p>We are now ready to test and evaluate the complete system with the
procesor, caches, and accelerator. We already developed the software to
control the accelerator with the FL model. So all we need to do is run
the test program and evaluation program on the accelerator RTL
implementation.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>--cache-impl<span class="w"> </span>rtl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">    </span>--xcel-impl<span class="w"> </span>gcd-rtl<span class="w"> </span>./ubmark-gcd-xcel-test
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>--cache-impl<span class="w"> </span>rtl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">    </span>--xcel-impl<span class="w"> </span>gcd-rtl<span class="w"> </span>./ubmark-gcd-xcel-eval
</span></code></pre></div>
<p>As always, do not simply rely on aggregate performance metrics. Dig into
the line trace to really understand what is going on.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>--cache-impl<span class="w"> </span>rtl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span>--xcel-impl<span class="w"> </span>gcd-rtl<span class="w"> </span>--trace<span class="w"> </span>./ubmark-gcd-xcel-eval<span class="w"> </span>&gt;<span class="w"> </span>ubmark-gcd-xcel-eval.dump
</span></code></pre></div>
<p>You should be able to understand every line and every column. It is
absolutely critical to use line traces productively to understand how the
processor, cache, and accelerator are all executing together.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>     fetch    decode                  mem  exe  wb   I$  D$  xcelreq     mngr gcdreq    a    b   ST  gcd xcelresp   imem  dmem
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>641: 000002fc|                       |jal |addi|addi[TC |I  ]              [X]         (0000 0000 I )    .                |
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>642: 00000300|csrw       0x7e0, x10  |    |jal |addi[TC |I  ]              [X]         (0000 0000 I )    .                |
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>643: 00000304|csrw       0x7e1, x11  |csrw|    |jal [TC |I  ]wr:00:00000007[X]         (0000 0000 I )    .                |
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>644: 00000308|csrr   x10,     0x7e2  |csrw|csrw|    [TC |I  ]wr:01:00000031[X]         (0000 0000 I )    wr:              |
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>645: 0000030c|jalr   x00, x01, 0x000 |csrr|csrw|csrw[TC |I  ]rd:02:        [X]         (0000 0000 I )    wr:              |
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>646: #       |#                      |#   |#   |csrw[TC |I  ]              [X]0007:0031(0000 0000 I )    .                |
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>647: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (0007 0031 Cs)    .                |
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>648: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (0031 0007 C-)    .                |
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>649: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (002a 0007 C-)    .                |
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>650: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (0023 0007 C-)    .                |
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>651: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (001c 0007 C-)    .                |
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a>652: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (0015 0007 C-)    .                |
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a>653: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (000e 0007 C-)    .                |
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>654: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (0007 0007 C-)    .                |
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a>655: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (0000 0007 Cs)    .                |
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>656: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (0007 0000 C )    .                |
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>657: #       |#                      |#   |#   |    [HWT|I  ]              [C].        (0007 0000 D )0007.                |
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a>658: /       |/                      |jalr|csrr|    [HWT|I  ]              [W]         (0007 0000 I )    rd:00000007      |
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a>659: #       |                       |    |jalr|csrr[I  |I  ]              [X]         (0000 0000 I )    .                |
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a>660: 0000075c|                       |    |    |jalr[TC |I  ]              [X]         (0000 0000 I )    .                |
</span></code></pre></div>
<p>Now we are ready to do the final experiment and see if our GCD
accelerator improves the peroformance compared to the software baseline!</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab5/app/build
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>%<span class="w"> </span>../../sim/pmx/pmx-sim<span class="w"> </span>--proc-impl<span class="w"> </span>rtl<span class="w"> </span>--cache-impl<span class="w"> </span>rtl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">    </span>--xcel-impl<span class="w"> </span>gcd-rtl<span class="w"> </span>--stats<span class="w"> </span>./ubmark-gcd-xcel-eval
</span></code></pre></div>
<h2 id="7-project-2">7. Project 2</h2>
<p>Now that you better understand the kind of medium-grain accelerators we
will be designing, implementing, testing, evaluating, and fabricating in
project 2, start to brainstorm what you want to tapeout in project 2. We
have some ideas here:</p>
<ul>
<li><a href="https://cornell-ece6745.github.io/ece6745-mkdocs/ece6745-project2-ideas">https://cornell-ece6745.github.io/ece6745-mkdocs/ece6745-project2-ideas</a></li>
</ul>
<p><strong>You must talk to Prof. Batten before you leave today about your ideas
for project 2.</strong></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Christopher Batten
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../js/extras.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/skins/default.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/wavedrom.min.js"></script>
      
        <script src="../js/wavedrom_loader.js"></script>
      
    
  </body>
</html>