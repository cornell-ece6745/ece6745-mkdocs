
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Christopher Batten">
      
      
      
        <link rel="prev" href="../ece6745-lab3/">
      
      
        <link rel="next" href="../ece6745-lab5/">
      
      
        
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Lab 4: TinyFlow Back End - ECE 6745 Complex Digital ASIC Design</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ece-6745-lab-4-tinyflow-back-end" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ECE 6745 Complex Digital ASIC Design" class="md-header__button md-logo" aria-label="ECE 6745 Complex Digital ASIC Design" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ECE 6745 Complex Digital ASIC Design
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 4: TinyFlow Back End
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/cornell-ece6745/ece6745-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    cornell-ece6745/ece6745-mkdocs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ece6745-tut00-remote-access/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ece6745-lab1/" class="md-tabs__link">
          
  
  
  Labs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ece6745-project1a/" class="md-tabs__link">
          
  
  
  Projects

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ece6745-tinyflow-180nm-drm/" class="md-tabs__link">
          
  
  
  Misc

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ECE 6745 Complex Digital ASIC Design" class="md-nav__button md-logo" aria-label="ECE 6745 Complex Digital ASIC Design" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ECE 6745 Complex Digital ASIC Design
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cornell-ece6745/ece6745-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    cornell-ece6745/ece6745-mkdocs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tut00-remote-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial 0: ECE Linux Server Remote Access
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tut01-linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial 1: Linux Development Environment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tut02-git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial 2: Git Distributed Version Control System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Labs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Labs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 1: Full-Custom Inverter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 2: Standard-Cell Inverter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 3: TinyFlow Front End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Lab 4: TinyFlow Back End
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 4: TinyFlow Back End
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-logging-into-ecelinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Logging Into ecelinux
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-data-structure-back-end-database" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Data Structure: Back End Database
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Data Structure: Back End Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-database-floorplan-and-the-grid" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1. Database, Floorplan, and the Grid
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-cells-io-ports-and-nets" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2. Cells, IO Ports, and Nets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-manually-placing-and-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3. Manually Placing and Routing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-reading-verilog" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4. Reading Verilog
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-algorithm-floorplan" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Algorithm: Floorplan
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Algorithm: Floorplan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-fixed-floorplan" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1. Fixed Floorplan
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-algorithm-unoptimized-placement" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Algorithm: Unoptimized Placement
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Algorithm: Unoptimized Placement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-random-placement" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1. Random placement
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-algorithm-unoptimized-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Algorithm: Unoptimized Routing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Algorithm: Unoptimized Routing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-check-lines" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1. Check Lines
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-manhattan-route-on-m2" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2. Manhattan Route on M2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-manhattan-route-multi-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3. Manhattan Route (Multi-Layer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-single-net-routing-single_route_unopt" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4. Single-Net Routing (single_route_unopt)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-multi-net-routing-multi_route_unopt" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5. Multi-Net Routing (multi_route_unopt)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-algorithm-add-filler" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Algorithm: Add Filler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-algorithm-layout-writer" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Algorithm: Layout Writer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-tinyflow-front-and-back-end" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. TinyFlow Front and Back End
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. TinyFlow Front and Back End">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-tiny-front-end-manual-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1. Tiny Front-End Manual Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-tiny-back-end-manual-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2. Tiny Back-End Manual Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-tiny-automated-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.3. Tiny Automated Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-lab5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab 5: TinyRV2 Accelerators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Projects
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Projects
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Project 1: TinyFlow Tape-Out
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project 1: TinyFlow Tape-Out
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project1a/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part A: TinyFlow Standard Cells
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project1b/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part B: TinyFlow Front End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project1c/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part C: TinyFlow Back End
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Misc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-tinyflow-180nm-drm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tinyflow 180nm Design Rules Manual
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ece6745-project2-ideas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project 2 Ideas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-logging-into-ecelinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Logging Into ecelinux
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-data-structure-back-end-database" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Data Structure: Back End Database
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Data Structure: Back End Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-database-floorplan-and-the-grid" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1. Database, Floorplan, and the Grid
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-cells-io-ports-and-nets" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2. Cells, IO Ports, and Nets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-manually-placing-and-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3. Manually Placing and Routing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-reading-verilog" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4. Reading Verilog
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-algorithm-floorplan" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Algorithm: Floorplan
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Algorithm: Floorplan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-fixed-floorplan" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1. Fixed Floorplan
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-algorithm-unoptimized-placement" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Algorithm: Unoptimized Placement
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Algorithm: Unoptimized Placement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-random-placement" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1. Random placement
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-algorithm-unoptimized-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Algorithm: Unoptimized Routing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Algorithm: Unoptimized Routing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-check-lines" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1. Check Lines
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-manhattan-route-on-m2" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2. Manhattan Route on M2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-manhattan-route-multi-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3. Manhattan Route (Multi-Layer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-single-net-routing-single_route_unopt" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4. Single-Net Routing (single_route_unopt)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-multi-net-routing-multi_route_unopt" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5. Multi-Net Routing (multi_route_unopt)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-algorithm-add-filler" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Algorithm: Add Filler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-algorithm-layout-writer" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Algorithm: Layout Writer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-tinyflow-front-and-back-end" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. TinyFlow Front and Back End
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. TinyFlow Front and Back End">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-tiny-front-end-manual-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1. Tiny Front-End Manual Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-tiny-back-end-manual-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2. Tiny Back-End Manual Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-tiny-automated-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.3. Tiny Automated Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="ece-6745-lab-4-tinyflow-back-end">ECE 6745 Lab 4: TinyFlow Back End</h1>
<p>In this lab, we will explore the TinyFlow back end which takes as input
a gate-level netlist of standard cells and produces a placed and routed
layout. The complete TinyFlow standard-cell and ASIC design flow is shown
below with the back end highlighted in red.</p>
<p><img alt="" src="../img/lab4-tinyflow.png" /></p>
<p>The back end includes floorplanning, placement, routing, and filler cell
insertion. In this lab, we will be implementing unoptimized versions of
placement and routing. The key algorithms in the unoptimized back end
flow are shown below.</p>
<p><img alt="" src="../img/lab4-pnr-flow.png" width="50%" /></p>
<h2 id="1-logging-into-ecelinux">1. Logging Into <code>ecelinux</code></h2>
<p>Follow the same process as previous labs. Find a free workstation and log
into the workstation using your NetID and standard NetID password. Then
complete the following steps.</p>
<ul>
<li>Start VS Code</li>
<li>Install the Remote-SSH extension, Surfer, and Verilog extensions</li>
<li>Use View &gt; Command Palette to execute Remote-SSH: Connect Current Window to Host...</li>
<li>Enter netid@ecelinux-XX.ece.cornell.edu where XX is an ecelinux server number</li>
<li>Use View &gt; Explorer to open your home directory on ecelinux</li>
<li>Use View &gt; Terminal to open a terminal on ecelinux</li>
<li>Start MS Remote Desktop</li>
</ul>
<p>Now use the following commands to clone the repo we will be using for
today's lab.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>%<span class="w"> </span><span class="nb">source</span><span class="w"> </span>setup-ece6745.sh
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>%<span class="w"> </span><span class="nb">source</span><span class="w"> </span>setup-gui.sh
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>%<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>%<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:cornell-ece6745/ece6745-lab4<span class="w"> </span>lab4
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>lab4
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>%<span class="w"> </span>tree
</span></code></pre></div>
<p>Your repo contains the following files.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>.
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>├── README.md
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>├── asic
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>│   └── build-fa
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>│       ├── 00-verilator-rtlsim
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>│       ├── 01-iverilog-rtlsim
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>│       ├── 02-tinyflow-synth
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>│       ├── 03-iverilog-ffglsim
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>│       └── 04-tinyflow-pnr
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>├── rtl
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>│   ├── FullAdder_cout.v
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>│   └── FullAdder_cout-post-synth.v
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>├── stdcells
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>└── tinyflow
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>    ├── pnr
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    │   ├── StdCellBackEndView.py
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    │   ├── TinyBackEndDB.py
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    │   ├── TinyBackEndGUI.py
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    │   ├── add_filler.py
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>    │   ├── floorplan.py
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>    │   ├── multi_route_unopt.py
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    │   ├── place_unopt.py
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>    │   └── single_route_unopt.py
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>    ├── tinyflow-synth
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>    └── tinyflow-pnr
</span></code></pre></div>
<p>Our back end flow uses the back end and layout views from the sandard
standard-cell library you developed in Project 1, Part A. You will also
need your synthesis tool for the end-to-end flow. Copy these files into
the lab4 directory.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab4
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>%<span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/project1-groupXX/stdcells/stdcells<span class="w"> </span>.
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>%<span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/project1-groupXX/tinyflow/synth<span class="w"> </span>tinyflow
</span></code></pre></div>
<p>where <code>XX</code> is your group number. We provide <code>FullAdder_cout.v</code> (the RTL)
and <code>FullAdder_cout-post-synth.v</code> (a pre-synthesized gate-level netlist)
in the <code>rtl</code> directory so you can test the back end flow directly.</p>
<p>To make it easier to cut-and-paste commands from this handout onto the
command line, you can tell Bash to ignore the <code>%</code> character using the
following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>%<span class="w"> </span><span class="nb">alias</span><span class="w"> </span>%<span class="o">=</span><span class="s2">&quot;&quot;</span>
</span></code></pre></div>
<p>Now you can cut-and-paste a sequence of commands from this tutorial
document and Bash will not get confused by the <code>%</code> character which begins
each line.</p>
<h2 id="2-data-structure-back-end-database">2. Data Structure: Back End Database</h2>
<p>As discussed in lecture, the back end takes a gate-level netlist and
produces a physical layout. The key data structure is the back end
database which manages <strong>cells</strong> (standard cell instances), <strong>IO ports</strong>
(block boundary pins), <strong>nets</strong> (connections between pins), a <strong>2D site
grid of sites</strong>, and a <strong>3D routing grid of nodes</strong>. The PnR algorithms
-- floorplanning, placement, and routing -- read and modify this
database. We provide students the database, and students are responsible
for writing the algorithms. Similar to the front end, we have a REPL for
interactive exploration of the back end database and algorithms.</p>
<p>In this section, we will manually build a small design from scratch in
the REPL to understand how these data structures work together. We will
add cells, create nets, set up a floorplan, place cells, and route nets
by hand before moving on to automated algorithms.</p>
<p>To get started, create a build directory and start the TinyFlow PnR
REPL.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>%<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab4/tinyflow/build
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece6745/lab4/tinyflow/build
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>%<span class="w"> </span>../tinyflow-pnr
</span></code></pre></div>
<h3 id="21-database-floorplan-and-the-grid">2.1. Database, Floorplan, and the Grid</h3>
<p>Before we can place cells or route wires, we need to set up the block's
physical foundation: the <strong>site grid</strong> and the <strong>routing grid</strong>. The
site grid is a 2D array of sites where cells can be placed. The
routing grid is a 3D array of nodes where wires can be routed across
multiple metal layers. Both are created when we call <code>floorplan</code> on the
database.</p>
<p>The figure below shows a top-down view of these two grids. Given the
block's overall dimensions (left), the floorplan divides the area into a
2D grid of <strong>sites</strong> (center). Each site is one standard-cell slot. On
top of that, a finer <strong>routing grid</strong> (right) provides nodes at every
track pitch where wires and vias can be placed. The routing grid has
many more rows than the site grid because sites are much taller than the
track pitch.</p>
<p><img alt="" src="../img/lab4-topdown-grids.png" /></p>
<p>The routing grid is actually 3D. Each node has coordinates <code>(i, j, k)</code>
where <code>i</code> and <code>j</code> identify a position on the block and <code>k</code> selects the
metal layer. The 3D view below shows how the routing grid stacks on top
of the site grid, extending across multiple metal layers (M1 to M6) with
vertical connections (vias) between layers.</p>
<p><img alt="" src="../img/lab4-3d-view.png" /></p>
<p>Let's try this in TinyFlow. We first create a back end library view and
an empty database, then call <code>floorplan</code> to set up a small block with 3
rows and 24 sites per row.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">floorplan</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
</span></code></pre></div>
<p><code>StdCellBackEndView</code> is the back end counterpart to the front end view
from Lab 3. It provides the physical information needed for place and
route: site dimensions, cell layouts (pin locations, cell widths), and
metal layer definitions.</p>
<p><code>TinyBackEndDB</code> is the central database for the back end. It stores all
cells, nets, pins, IO ports, and manages both the site grid and
routing grid. All PnR algorithms read and modify this database.</p>
<p><code>db.floorplan(num_rows, num_sites_per_row)</code> initializes the block's
physical grid. It creates a 2D array of sites (rows x columns)
where standard cells will be placed, and a 3D routing grid of nodes
across all metal layers where wires will be routed. Nothing can be placed
or routed until this is called. You should see the GUI show two panels:
the top panel is the site pane showing the grid in sites, and the
bottom panel is the routing pane showing a top-down view of the 3D
routing grid.</p>
<p><img alt="" src="../img/lab4-gui-floorplan.png" width="50%" /></p>
<p>Let's explore what <code>db.floorplan</code> created. First, check the dimensions
of the site grid and the routing grid.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_num_rows</span><span class="p">()</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_num_cols</span><span class="p">()</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_grid_size_i</span><span class="p">()</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_grid_size_j</span><span class="p">()</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>tinyflow-pnr&gt; db.get_num_rows()
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>3
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>tinyflow-pnr&gt; db.get_num_cols()
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>24
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>tinyflow-pnr&gt; db.get_grid_size_i()
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>25
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>tinyflow-pnr&gt; db.get_grid_size_j()
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>25
</span></code></pre></div>
</details>
<p>The site grid has <code>num_rows</code> rows and <code>num_cols</code> sites per row --
these are the coordinates you use when placing cells. The routing grid is
finer-grained: <code>grid_size_i</code> tracks in the vertical direction and
<code>grid_size_j</code> tracks in the horizontal direction, across multiple metal
layers.</p>
<p>Each placement site is represented by a <strong>Site</strong> object. A site is the
smallest unit of space where a cell can be placed, the same size as a
filler cell. Each rectangular box in the placement panel GUI corresponds
to one site. Let's inspect a site to see what information it tracks:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_site_at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_site_at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">occupied_by</span> <span class="o">==</span> <span class="kc">None</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>tinyflow-pnr&gt; db.get_site_at(0, 0)
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>&lt;Site(x=0, y=0, occupied=False)&gt;
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>tinyflow-pnr&gt; db.get_site_at(0, 0).occupied_by == None
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>True
</span></code></pre></div>
</details>
<p>The site at (0, 0) shows its coordinates and whether it is occupied.
Since we haven't placed any cells yet, <code>occupied_by</code> is <code>None</code>. Once we
place cells in Section 2.3, we will see this change.</p>
<p>Each routing grid point is represented by a <strong>Node</strong> object, addressed
by <code>(i, j, k)</code> where <code>i</code> is the row track, <code>j</code> is the column track, and
<code>k</code> is the metal layer (1=M1, 2=M2, etc.). In the routing panel of the
GUI, nodes are the intersections of the grid lines. Each node tracks what
occupies it: a net's wire, a cell pin, or an IO port. Let's inspect a
node to see what information it tracks:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_node_at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_occupancy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>tinyflow-pnr&gt; db.get_node_at(0, 0, 1)
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>&lt;Node(x=0, y=0, layer=1, occupied=None)&gt;
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>tinyflow-pnr&gt; db.get_occupancy(0, 0, 1) == None
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>True
</span></code></pre></div>
</details>
<p>The node at (0, 0, 1) is on M1 at row track 0, column track 0. Since
we haven't routed any wires yet, the occupancy is <code>None</code>. Once we route
nets in Section 2.3, we will see this change. <code>get_occupancy</code> will be
very useful later when implementing the routing algorithms to check
whether a node is available before routing through it.</p>
<h3 id="22-cells-io-ports-and-nets">2.2. Cells, IO Ports, and Nets</h3>
<p>Now that we have a floorplan, let's add cells, register IO ports, and
create nets to connect them. We will build a simple two-inverter chain:
input <code>a</code> drives <code>inv1</code>, whose output connects to <code>inv2</code>, whose output
drives output <code>y</code>.</p>
<p>A <strong>Cell</strong> represents an instance of a standard cell from the library
(e.g., INVX1, NAND2X1). When we add a cell to the database, it
automatically creates <strong>Pin</strong> objects based on the cell's layout
definition. Let's add two inverters:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="s1">&#39;inv1&#39;</span><span class="p">,</span> <span class="s1">&#39;INVX1&#39;</span><span class="p">)</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="s1">&#39;inv2&#39;</span><span class="p">,</span> <span class="s1">&#39;INVX1&#39;</span><span class="p">)</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>tinyflow-pnr&gt; db.add_cell(&#39;inv1&#39;, &#39;INVX1&#39;)
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>tinyflow-pnr&gt; db.add_cell(&#39;inv2&#39;, &#39;INVX1&#39;)
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>tinyflow-pnr&gt; db.get_cells()
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>(&lt;Cell inv1, INVX1, placed=False&gt;, &lt;Cell inv2, INVX1, placed=False&gt;)
</span></code></pre></div>
</details>
<p>Each cell has pins that we can inspect. Pins are not yet placed on the
grid since we haven't placed the cells yet. Note that the GUI only shows
placed cells, so you won't see them in the GUI here:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">inv1</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="s1">&#39;inv1&#39;</span><span class="p">)</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">inv1</span><span class="o">.</span><span class="n">get_pins</span><span class="p">()</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">inv1</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">inv1</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>tinyflow-pnr&gt; inv1 = db.get_cell(&#39;inv1&#39;)
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>tinyflow-pnr&gt; inv1.get_pins()
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>[&lt;Pin A (unplaced)&gt;, &lt;Pin Y (unplaced)&gt;]
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>tinyflow-pnr&gt; inv1.get_pin(&#39;A&#39;)
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>&lt;Pin A (unplaced)&gt;
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>tinyflow-pnr&gt; inv1.get_pin(&#39;A&#39;).get_node()
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>(None, None, None)
</span></code></pre></div>
</details>
<p>An <strong>IO Port</strong> represents an external signal at the block boundary. IO
ports are registered with <code>add_ioport</code> -- at this point, they are
unplaced, we just declare that they exist. They will be placed on the
block boundary later. Let's register that our design has an input <code>a</code>
and an output <code>y</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">add_ioport</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">)</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">add_ioport</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_ioports</span><span class="p">()</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>tinyflow-pnr&gt; db.add_ioport(&#39;a&#39;, &#39;input&#39;)
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>tinyflow-pnr&gt; db.add_ioport(&#39;y&#39;, &#39;output&#39;)
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>tinyflow-pnr&gt; db.get_ioports()
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>(&lt;Pin a (unplaced)&gt;, &lt;Pin y (unplaced)&gt;)
</span></code></pre></div>
</details>
<p><code>add_ioport</code> creates an IO port. It takes a direction to indicate
whether it is an input or output.</p>
<p>Now let's connect everything with <strong>Nets</strong>. A net represents a logical
connection between pins. For our inverter chain, we need three nets: <code>a</code>
connects the input IO port to <code>inv1</code>, <code>w</code> connects <code>inv1</code>'s output to
<code>inv2</code>'s input, and <code>y</code> connects <code>inv2</code>'s output to the output IO port.
Since IO ports are pins, we include them directly in the pin list.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">inv2</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="s1">&#39;inv2&#39;</span><span class="p">)</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">add_net</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">db</span><span class="o">.</span><span class="n">get_ioport</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="n">inv1</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)])</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">add_net</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">inv1</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span> <span class="n">inv2</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)])</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">add_net</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">inv2</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span> <span class="n">db</span><span class="o">.</span><span class="n">get_ioport</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)])</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_nets</span><span class="p">()</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>tinyflow-pnr&gt; inv2 = db.get_cell(&#39;inv2&#39;)
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>tinyflow-pnr&gt; db.add_net(&#39;a&#39;, [db.get_ioport(&#39;a&#39;), inv1.get_pin(&#39;A&#39;)])
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>tinyflow-pnr&gt; db.add_net(&#39;w&#39;, [inv1.get_pin(&#39;Y&#39;), inv2.get_pin(&#39;A&#39;)])
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>tinyflow-pnr&gt; db.add_net(&#39;y&#39;, [inv2.get_pin(&#39;Y&#39;), db.get_ioport(&#39;y&#39;)])
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>tinyflow-pnr&gt; db.get_nets()
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>(&lt;Net a, 2 pins&gt;, &lt;Net w, 2 pins&gt;, &lt;Net y, 2 pins&gt;)
</span></code></pre></div>
</details>
<p>Nets <code>a</code> and <code>y</code> each have two pins: a cell pin and an IO port. Net <code>w</code>
is an internal wire between the two inverters with no IO port. Let's
verify:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pins</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pins</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pins</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>tinyflow-pnr&gt; db.get_net(&#39;a&#39;).pins
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>[&lt;Pin a (unplaced)&gt;, &lt;Pin A (unplaced)&gt;]
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>tinyflow-pnr&gt; db.get_net(&#39;w&#39;).pins
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>[&lt;Pin Y (unplaced)&gt;, &lt;Pin A (unplaced)&gt;]
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>tinyflow-pnr&gt; db.get_net(&#39;y&#39;).pins
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>[&lt;Pin Y (unplaced)&gt;, &lt;Pin y (unplaced)&gt;]
</span></code></pre></div>
</details>
<p>Note that the IO ports are registered but not yet placed. We will place
them on the block boundary later in Section 2.3.</p>
<p>With cells, IO ports, and nets defined, we have fully described the
gate-level netlist -- what components exist and how they should be
connected. The next step is to physically place and route them on the
block.</p>
<h3 id="23-manually-placing-and-routing">2.3. Manually Placing and Routing</h3>
<p>With cells, IO ports, and nets created, let's physically place the cells
and IO ports on the grid and manually route a net.</p>
<p>Let's start with placing a cell. <code>cell.set_place(row, col)</code> places a cell with its origin at site
<code>(row, col)</code>. The cell occupies one or more sites to the right depending
on its width. If any of those sites are already occupied by another cell,
the database raises an error. Cells in even rows are oriented normally; cells in odd rows are flipped
vertically so that adjacent rows share VDD and VSS power rails. Go
ahead and place <code>inv1</code> at (0, 2) and <code>inv2</code> at (2, 5):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">inv1</span><span class="o">.</span><span class="n">set_place</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">inv2</span><span class="o">.</span><span class="n">set_place</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></code></pre></div>
<p>You should see something like this:</p>
<p><img alt="" src="../img/lab4-gui-placed-cells.png" width="50%" /></p>
<p>The cells should now appear in the placement panel as green boxes labeled with
the cell name. In the routing panel, each placed cell shows as a teal dotted shadow
box with its pin locations marked as yellow squares. When a cell is
placed, its pins get assigned grid coordinates on metal layer 1 (M1):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">inv1</span><span class="o">.</span><span class="n">is_placed</span><span class="p">()</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">inv1</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">inv2</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>tinyflow-pnr&gt; inv1.is_placed()
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>True
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>tinyflow-pnr&gt; inv1.get_pin(&#39;Y&#39;).get_node()
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>(4, 4, 1)
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>tinyflow-pnr&gt; inv2.get_pin(&#39;A&#39;).get_node()
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>(20, 6, 1)
</span></code></pre></div>
</details>
<p>Let's then place the IO ports on the block boundary. Recall that we
registered them earlier but they were unplaced. We use <code>ioport.place(i,
j)</code> to assign them to a grid location on the boundary. IO ports are
placed on M2:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_ioport</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_ioport</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</span></code></pre></div>
<p>You should see the Routing panel include the IO ports as light blue square boxes.</p>
<p><img alt="" src="../img/lab4-gui-placed-ports.png" width="50%" /></p>
<p>Let's run <code>db.check_design()</code> to verify our placement:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">check_design</span><span class="p">()</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>tinyflow-pnr&gt; db.check_design()
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>INFO: Placement check passed
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>WARNING: UNROUTED: Net &#39;a&#39; pins not fully connected
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>WARNING: UNROUTED: Net &#39;w&#39; pins not fully connected
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>WARNING: UNROUTED: Net &#39;y&#39; pins not fully connected
</span></code></pre></div>
</details>
<p>Placement passes, but all three nets are unrouted. Now that our cells and IO ports are placed, we want to connect their pins with wires.
A wire is represented as a <strong>Line</strong>, a straight segment between two 3D
grid points <code>(i, j, k)</code>. Exactly one coordinate changes: <code>i</code> or <code>j</code> for
a wire on the same metal layer, or <code>k</code> for a via between layers.</p>
<p>Cell pins live on M1 (k=1), but routing happens on M2 and above. In this
example we will route on M2. To connect two cell pins, we need to:</p>
<ol>
<li>Go up from M1 to M2 at the source pin (via)</li>
<li>Route on M2 to reach the destination (wire segments)</li>
<li>Come back down from M2 to M1 at the destination pin (via)</li>
</ol>
<p>Since our two inverters are at different rows, the M2 route requires two
segments forming an L-shape. Let's route net <code>w</code> which connects <code>inv1.Y</code>
to <code>inv2.A</code>. We will add each line segment one at a time so you can see
the route build up in the GUI:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">src_x</span><span class="p">,</span> <span class="n">src_y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">inv1</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">dst_x</span><span class="p">,</span> <span class="n">dst_y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">inv2</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_w</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_w</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">([</span><span class="n">Line</span><span class="p">((</span><span class="n">src_x</span><span class="p">,</span> <span class="n">src_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">src_x</span><span class="p">,</span> <span class="n">src_y</span><span class="p">,</span> <span class="mi">2</span><span class="p">))])</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_w</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">([</span><span class="n">Line</span><span class="p">((</span><span class="n">src_x</span><span class="p">,</span> <span class="n">src_y</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">src_x</span><span class="p">,</span> <span class="n">dst_y</span><span class="p">,</span> <span class="mi">2</span><span class="p">))])</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_w</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">([</span><span class="n">Line</span><span class="p">((</span><span class="n">src_x</span><span class="p">,</span> <span class="n">dst_y</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">dst_x</span><span class="p">,</span> <span class="n">dst_y</span><span class="p">,</span> <span class="mi">2</span><span class="p">))])</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_w</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">([</span><span class="n">Line</span><span class="p">((</span><span class="n">dst_x</span><span class="p">,</span> <span class="n">dst_y</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">dst_x</span><span class="p">,</span> <span class="n">dst_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">))])</span>
</span></code></pre></div>
<p><img alt="" src="../img/lab4-gui-manual-route.png" width="50%" /></p>
<p>The route should now appear in the routing panel of the GUI. You can
verify the node occupancy along the route:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_occupancy</span><span class="p">(</span><span class="n">src_x</span><span class="p">,</span> <span class="n">src_y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_w</span><span class="o">.</span><span class="n">get_route</span><span class="p">()</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>tinyflow-pnr&gt; db.get_occupancy(src_x, src_y, 2)
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>&lt;Net w, 2 pins&gt;
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>tinyflow-pnr&gt; net_w.get_route()
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>[Line((4, 4, 1) -&gt; (4, 4, 2)), Line((4, 4, 2) -&gt; (4, 6, 2)), Line((4, 6, 2) -&gt; (20, 6, 2)), Line((20, 6, 2) -&gt; (20, 6, 1))]
</span></code></pre></div>
</details>
<p>At this point, we have only routed net <code>w</code>. Let's run <code>db.check_design()</code>
to see if there are any issues:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">check_design</span><span class="p">()</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>tinyflow-pnr&gt; db.check_design()
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>INFO: Placement check passed
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>WARNING: UNROUTED: Net &#39;a&#39; pins not fully connected
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>WARNING: UNROUTED: Net &#39;y&#39; pins not fully connected
</span></code></pre></div>
</details>
<p>The checker reports that nets <code>a</code> and <code>y</code> are not yet routed.
Now let's route the IO ports to their cells. Recall that IO ports are
on M2 while cell pins are on M1. For net <code>a</code>, the IO port is already on
M2, so we route on M2 to reach <code>inv1.A</code> and via down. For net <code>y</code>, we
via up from <code>inv2.Y</code> to M2, route on M2 to reach the IO port:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_a</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_ioport</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">pin_a</span> <span class="o">=</span> <span class="n">inv1</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_a</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_a</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">([</span><span class="n">Line</span><span class="p">((</span><span class="n">io_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">io_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">io_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pin_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))])</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_a</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">([</span><span class="n">Line</span><span class="p">((</span><span class="n">io_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pin_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">pin_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pin_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))])</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_a</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">([</span><span class="n">Line</span><span class="p">((</span><span class="n">pin_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pin_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">pin_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pin_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))])</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_y</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_ioport</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">pin_y</span> <span class="o">=</span> <span class="n">inv2</span><span class="o">.</span><span class="n">get_pin</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_y</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_y</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">([</span><span class="n">Line</span><span class="p">((</span><span class="n">pin_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pin_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">pin_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pin_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))])</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_y</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">([</span><span class="n">Line</span><span class="p">((</span><span class="n">pin_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pin_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">pin_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">io_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))])</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_y</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">([</span><span class="n">Line</span><span class="p">((</span><span class="n">pin_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">io_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">io_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">io_y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))])</span>
</span></code></pre></div>
<p><img alt="" src="../img/lab4-gui-manual-pin-route.png" width="50%" /></p>
<p>Now run <code>db.check_design()</code> again, your design should pass both placement and routing check now.</p>
<h3 id="24-reading-verilog">2.4. Reading Verilog</h3>
<p>In practice, we don't manually add cells, IO ports, and nets. The front
end generates a gate-level Verilog netlist, and <code>db.read_verilog</code> reads
it to create all cells, IO ports, and nets automatically. We have
provided a synthesized <code>FullAdder_cout</code> design from lecture. Let's load
it and verify what was created:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../../rtl/FullAdder_cout-post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_ioports</span><span class="p">()</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_nets</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="3-algorithm-floorplan">3. Algorithm: Floorplan</h2>
<p>In Section 2, we called <code>db.floorplan</code> directly with the number of rows
and sites per row. In practice, the floorplan algorithm computes the grid
dimensions and places IO ports on the block boundary.</p>
<p>There are two approaches. <code>floorplan_fixed</code> takes explicit block width and
height in micrometers along with IO port locations, and converts those
physical dimensions into grid coordinates. <code>floorplan_auto</code> computes the
block dimensions automatically from the total cell area and a target
utilization. In this lab, we will implement <code>floorplan_fixed</code>.</p>
<h3 id="31-fixed-floorplan">3.1. Fixed Floorplan</h3>
<p><code>floorplan_fixed</code> takes the block width and height in micrometers, along
with a dictionary of IO port locations also in micrometers. It converts
all physical dimensions into grid coordinates using the back end library
view.</p>
<p>The algorithm works as follows:</p>
<ol>
<li>Get the technology's lambda value in micrometers from
   <code>view.get_lambda_um()</code> and the site dimensions in lambda from
   <code>view.get_site()</code></li>
<li>Convert the block width and height from micrometers to lambda by
   dividing by lambda_um</li>
<li>Compute the number of rows and columns by dividing the lambda
   dimensions by the site height and site width</li>
<li>Call <code>db.floorplan(num_rows, num_cols)</code> to initialize the placement
   and routing grids</li>
<li>For each IO port, convert its (x_um, y_um) location from micrometers
   to routing grid coordinates (i, j). You will need the metal1 track
   pitch, which you can get with
   <code>view.get_layer('metal1').get_track_pitch()</code>. Divide the lambda
   coordinate by the track pitch to get the grid index. Then call
   <code>ioport.place(i, j)</code> to place each port on the grid</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Function: <code>floorplan_fixed(db, view, width_um, height_um, io_locs)</code></p>
<p><strong>Args:</strong></p>
<ul>
<li><code>db</code> -- TinyBackEndDB with cells and nets loaded</li>
<li><code>view</code> -- StdCellBackEndView with site dimensions and lambda</li>
<li><code>width_um</code> -- Block width in micrometers</li>
<li><code>height_um</code> -- Block height in micrometers</li>
<li><code>io_locs</code> -- Dict mapping port names to (x_um, y_um) locations</li>
</ul>
<p><strong>Returns:</strong> None (modifies db in place)</p>
</div>
<p>Go ahead and implement <code>floorplan_fixed</code> in <code>floorplan.py</code>. Use
<code>logging.info</code> to print useful information such as the computed number of
rows and columns. Once you are done, you can test your implementation
using the <code>FullAdder_cout</code> design from lecture:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../../rtl/FullAdder_cout-post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span> <span class="s1">&#39;cin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span> <span class="s1">&#39;cout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">28.8</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">)</span> <span class="p">}</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_num_rows</span><span class="p">()</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_num_cols</span><span class="p">()</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_ioports</span><span class="p">()</span>
</span></code></pre></div>
<details class="info">
<summary>Expected output</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>tinyflow-pnr&gt; db.get_num_rows()
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>5
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>tinyflow-pnr&gt; db.get_num_cols()
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>40
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>tinyflow-pnr&gt; db.get_ioports()
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>(&lt;Pin a @(10,0,2)&gt;, &lt;Pin b @(20,0,2)&gt;, &lt;Pin cin @(30,0,2)&gt;, &lt;Pin cout @(20,40,2)&gt;)
</span></code></pre></div>
</details>
<h2 id="4-algorithm-unoptimized-placement">4. Algorithm: Unoptimized Placement</h2>
<p>Placement assigns each cell to a location on the site grid. The
goal is to find positions for all cells such that no two cells overlap.
In an optimized flow, placement also minimizes wire length and improves
timing. In this lab, we will implement <code>place_unopt</code>, which randomly
assigns cells to grid positions without any optimization. In the
project, we will build on this random placement using simulated annealing
to iteratively improve cell positions for wire length.</p>
<h3 id="41-random-placement">4.1. Random placement</h3>
<p>The random placement we implement in this lab is a naive version that
simply places cells at random positions without any optimization. If we
recall the standard cells we drew in Part A, cells can have different
widths. A site is the minimum cell width, and the site grid is the
fine-grained grid of all site positions. To ensure no overlap, we use a
coarser grid which we will refer to as the <em>placement grid</em>. We divide
the columns into slots that are each as wide as the widest cell. Since
every slot is at least as wide as any cell, placing one cell per slot in the placement grid
guarantees no overlap.</p>
<p>The algorithm works as follows:</p>
<ol>
<li>Find the maximum cell width across all cells</li>
<li>Compute the number of placement columns by dividing the total columns
   by the max cell width</li>
<li>Randomly assign each cell to a unique placement grid position, placing
   it at (row, placement_col * max_width)</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Function: <code>place_unopt(db, view, seed=0)</code></p>
<p><strong>Args:</strong></p>
<ul>
<li><code>db</code> -- TinyBackEndDB with floorplan initialized</li>
<li><code>view</code> -- StdCellBackEndView (unused, for consistency)</li>
<li><code>seed</code> -- Random seed</li>
</ul>
<p><strong>Returns:</strong> None (modifies db in place)</p>
</div>
<p>Go ahead and implement <code>place_unopt</code> in <code>place_unopt.py</code>. You can use
<code>logging.info</code> to print useful information such as the number of cells
placed or cell's placed location. You can pass in a different seed to
try a different random placement.</p>
<p>Once you are done, test your implementation in the REPL:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../../rtl/FullAdder_cout-post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span> <span class="s1">&#39;cin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span> <span class="s1">&#39;cout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">28.8</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">)</span> <span class="p">}</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">place_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_placed</span><span class="p">()</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_place</span><span class="p">()</span>
</span></code></pre></div>
<p>You should see all cells placed on the grid in the GUI. Each cell
appears as a labeled box in the placement panel, with pin locations
shown as yellow squares in the routing panel.</p>
<h2 id="5-algorithm-unoptimized-routing">5. Algorithm: Unoptimized Routing</h2>
<p>Routing draws the metal wiring and vias that connect the pins of each
net. In Section 2, we manually routed a net by creating Line segments
for vias and wires. In this section, we will automate that process. In
this lab, we will implement a naive router that connects pins using
manhattan L-shaped routes. Similar to Lab 3, we will start by
implementing small modular functions and build up towards a working
multi-net router. In the project, we will replace this with an optimized
router.</p>
<h3 id="51-check-lines">5.1. Check Lines</h3>
<p>Before we can route a net, we need a way to check whether a proposed
route is valid. When routing a net, we construct a <strong>route</strong> for that
net. A route is a list of <strong>Lines</strong>, where each Line is a straight
segment between two grid points with exactly one coordinate changing
(a wire in the x or y direction on one layer, or a via in the z
direction between layers). Together, the Lines in a route form the
complete wiring for one net.</p>
<p>Each Line passes through a sequence of grid points. If any of those
points is already occupied by another net's wire, we cannot use that
route. For example, if two nets try to use the same node on M2, that
would be a short circuit.</p>
<p>A Line provides <code>get_points()</code> which returns all grid points along the
segment. We can check each point using <code>db.get_occupancy(i, j, k)</code>,
which returns the net occupying that node or <code>None</code> if it is available.
A point is a collision only if it is occupied by a different net. Points
occupied by the current net are allowed since a net can cross its own
wires.</p>
<p>The algorithm works as follows:</p>
<ol>
<li>For each Line in the list, get all grid points using
   <code>line.get_points()</code></li>
<li>For each point, check occupancy using <code>db.get_occupancy(i, j, k)</code></li>
<li>If occupied by a different net, return <code>False</code></li>
<li>If all points are clear (or occupied by the same net), return <code>True</code></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Function: <code>check_lines(db, net, lines)</code></p>
<p><strong>Args:</strong></p>
<ul>
<li><code>db</code> -- TinyBackEndDB for occupancy checks</li>
<li><code>net</code> -- Current net (allowed to use its own nodes)</li>
<li><code>lines</code> -- List of Line segments to check</li>
</ul>
<p><strong>Returns:</strong> True if all lines are clear, False if any collision</p>
</div>
<p>Go ahead and implement <code>check_lines</code> in <code>single_route_unopt.py</code>.</p>
<p>To test, set up the design, then manually add a route to one net and
check if the same lines collide with a different net:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../../rtl/FullAdder_cout-post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span> <span class="s1">&#39;cin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span> <span class="s1">&#39;cout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">28.8</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">)</span> <span class="p">}</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">place_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_a</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_b</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))]</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_a</span><span class="o">.</span><span class="n">add_route_segments</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">check_lines</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">net_b</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">check_lines</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">net_a</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
</span></code></pre></div>
<p>The first check should return <code>False</code> since the nodes are occupied by
<code>net_a</code>. The second check should return <code>True</code> since a net is allowed
to cross its own wires.</p>
<h3 id="52-manhattan-route-on-m2">5.2. Manhattan Route on M2</h3>
<p>Now we implement a simple routing function that only routes on the M2
layer. Given two pin locations on M1, <code>manhattan_route_m2</code> connects them
with an L-shaped route on M2. Recall from Section 2 that a route is
made up of Line segments. To go from one pin to another, we need four
Lines: a via up from M1 to M2 at the source, a horizontal wire on M2,
a vertical wire on M2, and a via down from M2 to M1 at the destination.
The two wire segments form an L-shape (manhattan route) that meets at a
right angle.</p>
<p>The algorithm first tries one L-shape ordering, then the other:</p>
<ol>
<li>Try x-then-y: construct Lines for via up (M1 to M2), x-direction
   wire, y-direction wire, via down (M2 to M1). Use <code>check_lines</code> to
   test for collisions. If clear, commit with
   <code>net.add_route_segments(lines)</code> and return <code>True</code>.</li>
<li>Try y-then-x: construct Lines for via up, y-direction wire,
   x-direction wire, via down. Check and commit if clear.</li>
<li>If both orderings collide, return <code>False</code>.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Function: <code>manhattan_route_m2(db, net, start, end)</code></p>
<p><strong>Args:</strong></p>
<ul>
<li><code>db</code> -- TinyBackEndDB for occupancy checks</li>
<li><code>net</code> -- Net to add route to</li>
<li><code>start</code> -- Starting (i, j, k) tuple on M1</li>
<li><code>end</code> -- Ending (i, j, k) tuple on M1</li>
</ul>
<p><strong>Returns:</strong> True if route found and committed, False if both orderings blocked</p>
</div>
<p>Go ahead and implement <code>manhattan_route_m2</code> in <code>single_route_unopt.py</code>.
To test, pick a net and route between its first two pins:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../../rtl/FullAdder_cout-post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span> <span class="s1">&#39;cin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span> <span class="s1">&#39;cout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">28.8</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">)</span> <span class="p">}</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">place_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="c1"># Try routing g&#39;s first two pins</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_g</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">start</span> <span class="o">=</span> <span class="n">net_g</span><span class="o">.</span><span class="n">pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">end</span> <span class="o">=</span> <span class="n">net_g</span><span class="o">.</span><span class="n">pins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">manhattan_route_m2</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">net_g</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_g</span><span class="o">.</span><span class="n">get_route</span><span class="p">()</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="c1"># Try routing _net_10&#39;s first two pins</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_n10</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;_net_10&#39;</span><span class="p">)</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">start</span> <span class="o">=</span> <span class="n">net_n10</span><span class="o">.</span><span class="n">pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">end</span> <span class="o">=</span> <span class="n">net_n10</span><span class="o">.</span><span class="n">pins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">manhattan_route_m2</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">net_n10</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span></code></pre></div>
<p>The first route (<code>g</code>) should return <code>True</code>. In the GUI, the start and
end pins should now show a filled circle (the via) where there was
previously an empty square, and you should see the L-shaped wire
segments connecting them. The second route (<code>_net_10</code>) should return
<code>False</code> because its path crosses <code>g</code>'s route on M2.</p>
<p><img alt="" src="../img/lab4-gui-mh_route_m2.png" width="50%" /></p>
<h3 id="53-manhattan-route-multi-layer">5.3. Manhattan Route (Multi-Layer)</h3>
<p>Now we generalize <code>manhattan_route_m2</code> to try multiple metal layers.
Instead of only routing on M2, <code>manhattan_route</code> tries each routing
layer from M6 down to M2. We try higher layers first with the hope
that routing on upper layers leaves the lower layers free for later
nets, reducing the chance of congestion.</p>
<p>The algorithm works as follows:</p>
<ol>
<li>For each layer from M6 down to M2:</li>
<li>Try x-then-y: construct 4 Lines (via up, x-wire, y-wire, via down).
   Use <code>check_lines</code> to test. If clear, commit and return <code>True</code>.</li>
<li>Try y-then-x: construct 4 Lines. Check and commit if clear.</li>
<li>If all layers and orderings fail, return <code>False</code>.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Function: <code>manhattan_route(db, net, start, end)</code></p>
<p><strong>Args:</strong></p>
<ul>
<li><code>db</code> -- TinyBackEndDB for occupancy checks</li>
<li><code>net</code> -- Net to add route to</li>
<li><code>start</code> -- Starting (i, j, k) tuple</li>
<li><code>end</code> -- Ending (i, j, k) tuple</li>
</ul>
<p><strong>Returns:</strong> True if route found and committed, False if all options blocked</p>
</div>
<p>Go ahead and implement <code>manhattan_route</code> in <code>single_route_unopt.py</code>.
To test, try the same two nets from Section 5.2 but using
<code>manhattan_route</code> instead. Both should succeed since the multi-layer
version can route on different layers:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../../rtl/FullAdder_cout-post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span> <span class="s1">&#39;cin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span> <span class="s1">&#39;cout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">28.8</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">)</span> <span class="p">}</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">place_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="c1"># Try routing g&#39;s first two pins</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_g</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">start</span> <span class="o">=</span> <span class="n">net_g</span><span class="o">.</span><span class="n">pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">end</span> <span class="o">=</span> <span class="n">net_g</span><span class="o">.</span><span class="n">pins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">manhattan_route</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">net_g</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="c1"># Try routing _net_10&#39;s first two pins</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">net_n10</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;_net_10&#39;</span><span class="p">)</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">start</span> <span class="o">=</span> <span class="n">net_n10</span><span class="o">.</span><span class="n">pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">end</span> <span class="o">=</span> <span class="n">net_n10</span><span class="o">.</span><span class="n">pins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">manhattan_route</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">net_n10</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span></code></pre></div>
<p>Both should return <code>True</code>. The first net routes on the highest
available layer (M6), and the second net finds a different free layer
since they no longer compete for M2.</p>
<h3 id="54-single-net-routing-single_route_unopt">5.4. Single-Net Routing (<code>single_route_unopt</code>)</h3>
<p>Now we put the pieces together to route a single net. A net can have
more than two pins (e.g., a fan-out net). <code>single_route_unopt</code> connects
all pins sequentially using <code>manhattan_route</code>. Note that if a pair
fails partway through, the previously routed segments are still
committed -- the net's route will be incomplete but the partial
segments remain on the grid.</p>
<p>The algorithm works as follows:</p>
<ol>
<li>Get the net by name and collect all pin locations</li>
<li>For each consecutive pair of pins (pin 0→1, pin 1→2, etc.), call
   <code>manhattan_route</code> to connect them</li>
<li>If any pair fails, return <code>False</code></li>
<li>If all pairs succeed, mark the net as routed and return <code>True</code></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Function: <code>single_route_unopt(db, net_name)</code></p>
<p><strong>Args:</strong></p>
<ul>
<li><code>db</code> -- TinyBackEndDB with placed design</li>
<li><code>net_name</code> -- Name of the net to route</li>
</ul>
<p><strong>Returns:</strong> True if routing succeeded, False otherwise</p>
</div>
<p>Go ahead and implement <code>single_route_unopt</code> in <code>single_route_unopt.py</code>.
To test, route a single net by name:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../../rtl/FullAdder_cout-post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span> <span class="s1">&#39;cin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span> <span class="s1">&#39;cout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">28.8</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">)</span> <span class="p">}</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">place_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">single_route_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">get_net</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_route</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="55-multi-net-routing-multi_route_unopt">5.5. Multi-Net Routing (<code>multi_route_unopt</code>)</h3>
<p>Finally, we route all nets in the design.</p>
<p>The algorithm works as follows:</p>
<ol>
<li>Get all nets from the database</li>
<li>For each net with two or more pins, call <code>single_route_unopt</code></li>
<li>Track which nets failed to route</li>
<li>Return <code>True</code> if all nets routed, <code>False</code> otherwise</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Function: <code>multi_route_unopt(db, view)</code></p>
<p><strong>Args:</strong></p>
<ul>
<li><code>db</code> -- TinyBackEndDB with placed design</li>
<li><code>view</code> -- StdCellBackEndView (unused, for consistency)</li>
</ul>
<p><strong>Returns:</strong> True if all nets routed, False otherwise</p>
</div>
<p>Go ahead and implement <code>multi_route_unopt</code> in <code>multi_route_unopt.py</code>.
To test, route all nets in the design:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../../rtl/FullAdder_cout-post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span> <span class="s1">&#39;cin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span> <span class="s1">&#39;cout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">28.8</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">)</span> <span class="p">}</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">place_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">multi_route_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span></code></pre></div>
<p>With your implementation, <strong><em>it is possible that not all nets route
successfully</em></strong>. This is expected -- with a random unoptimized placement,
some nets may fail to route due to congestion. Try a different seed to
see how placement affects routability.</p>
<h2 id="6-algorithm-add-filler">6. Algorithm: Add Filler</h2>
<p>After placement and routing, some sites on the grid may still be empty.
In a real chip, every site must be filled to satisfy manufacturing
design rules and maintain continuous power rails. <code>add_filler</code> walks
through every site in the site grid and marks any unoccupied site
as a filler cell.</p>
<p>The algorithm works as follows:</p>
<ol>
<li>Get the site grid using <code>db.get_core()</code>, which returns a 2D array
   of sites</li>
<li>Iterate through every site in the grid</li>
<li>For each site, check if it is unoccupied using <code>site._get_occupancy()</code></li>
<li>If unoccupied, mark it as filler using <code>site.add_filler()</code></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Function: <code>add_filler(db, view)</code></p>
<p><strong>Args:</strong></p>
<ul>
<li><code>db</code> -- TinyBackEndDB with placed and routed design</li>
<li><code>view</code> -- StdCellBackEndView (unused, for consistency)</li>
</ul>
<p><strong>Returns:</strong> None (modifies db in place)</p>
</div>
<p>Go ahead and implement <code>add_filler</code> in <code>add_filler.py</code>. To test:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../../rtl/FullAdder_cout-post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span> <span class="s1">&#39;cin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span> <span class="s1">&#39;cout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">28.8</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">)</span> <span class="p">}</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">place_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">multi_route_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">add_filler</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span></code></pre></div>
<p>You should see the empty sites in the GUI filled in after running
<code>add_filler</code>.</p>
<h2 id="7-algorithm-layout-writer">7. Algorithm: Layout Writer</h2>
<p>The final step is to write out the layout as a GDS file. This is
provided for you -- simply call <code>db.write_gds</code> with the desired output
filename:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span><span class="n">be</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span> <span class="n">gds</span><span class="o">=</span><span class="s1">&#39;../../stdcells/stdcells.gds&#39;</span><span class="p">)</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../../rtl/FullAdder_cout-post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span> <span class="s1">&#39;cin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span> <span class="s1">&#39;cout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">28.8</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">)</span> <span class="p">}</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">place_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">multi_route_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">add_filler</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">check_design</span><span class="p">()</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">report_summary</span><span class="p">()</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">write_gds</span><span class="p">(</span><span class="s1">&#39;FA_cout.gds&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>This merges your placed and routed design with the standard cell
layouts and writes the combined result to a GDS file. Open
<code>FA_cout.gds</code> in KLayout to inspect the final physical layout.</p>
<h2 id="8-tinyflow-front-and-back-end">8. TinyFlow Front and Back End</h2>
<p>The complete TinyFlow includes both the front-end and back-end. The
front-end flow consists of four steps: two-state simulation, four-state
simulation, synthesis, and fast-functional gate-level simulation. The
back-end flow consists of three steps: place-and-route, design rule
checking, and layout-vs-schematic. In this final part, we push the full
adder design through all steps of the fron-end flow and the
place-and-route step of the back-end flow to illustrate going from
Verilog RTL to a gate-level netlist to layout. We first manually run each
step before showing how we can automate running the flow.</p>
<h3 id="81-tiny-front-end-manual-flow">8.1. Tiny Front-End Manual Flow</h3>
<p>We need to first run the front-end flow as in the previous lab and
project 1B to generate the gate-level netlist. We provide the Verilog RTL
in <code>rtl/FullAdder.v</code> and a basic testbench in
<code>rtl/test/FullAdder-test.v</code>. These are the same as in the previous lab.
Trun the two-state simulation with Verilator.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/playground/01-verilator-rtlsim
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>%<span class="w"> </span>verilator<span class="w"> </span>--top<span class="w"> </span>Top<span class="w"> </span>--timing<span class="w"> </span>--binary<span class="w"> </span>-o<span class="w"> </span>FullAdder-test<span class="w"> </span><span class="se">\</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">    </span>../../../rtl/FullAdder.v<span class="w"> </span><span class="se">\</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">    </span>../../../rtl/test/FullAdder-test.v
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>%<span class="w"> </span>./obj_dir/FullAdder-test
</span></code></pre></div>
<p>Now run four-state simulation with Icarus Verilog.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/playground/02-iverilog-rtlsim
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>%<span class="w"> </span>iverilog<span class="w"> </span>-g2012<span class="w"> </span>-o<span class="w"> </span>FullAdder-test<span class="w"> </span><span class="se">\</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">    </span>../../../rtl/FullAdder.v<span class="w"> </span><span class="se">\</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">    </span>../../../rtl/test/FullAdder-test.v
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>%<span class="w"> </span>./FullAdder-test
</span></code></pre></div>
<p>Create a <code>run.py</code> script for synthesis.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/playground/03-tinyflow-synth
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>%<span class="w"> </span>code<span class="w"> </span>run.py
</span></code></pre></div>
<p>Populate the script with the commands to perform optimized technology
mapping and static timing analysis using your work Project 1B.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1"># Load the standard-cell front-end view and create front-end database</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="n">view</span> <span class="o">=</span> <span class="n">StdCellFrontEndView</span><span class="o">.</span><span class="n">parse_lib</span><span class="p">(</span><span class="s2">&quot;../../../stdcells/stdcells-fe.yml&quot;</span><span class="p">)</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="n">db</span> <span class="o">=</span> <span class="n">TinyFrontEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="c1"># Read Verilog file into the database</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s2">&quot;../../../rtl/FullAdder.v&quot;</span><span class="p">)</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="c1"># Optimized technology mapping</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="n">techmap</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="c1"># Static timing analysis with output load of 10fF</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="n">output_load</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="n">sta</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">output_load</span><span class="p">)</span>
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a>
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a><span class="c1"># Check design for issues</span>
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a>
</span><span id="__span-48-21"><a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a><span class="n">db</span><span class="o">.</span><span class="n">check_design</span><span class="p">()</span>
</span><span id="__span-48-22"><a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a>
</span><span id="__span-48-23"><a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a><span class="c1"># Output reports</span>
</span><span id="__span-48-24"><a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a>
</span><span id="__span-48-25"><a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a><span class="n">db</span><span class="o">.</span><span class="n">report_area</span><span class="p">()</span>
</span><span id="__span-48-26"><a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a><span class="n">db</span><span class="o">.</span><span class="n">report_timing</span><span class="p">()</span>
</span><span id="__span-48-27"><a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a><span class="n">db</span><span class="o">.</span><span class="n">report_summary</span><span class="p">()</span>
</span><span id="__span-48-28"><a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a>
</span><span id="__span-48-29"><a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a><span class="c1"># Write front-end database to a Verilog gate-level netlist</span>
</span><span id="__span-48-30"><a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a>
</span><span id="__span-48-31"><a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a><span class="n">db</span><span class="o">.</span><span class="n">write_verilog</span><span class="p">(</span><span class="s2">&quot;post-synth.v&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Now go ahead and run synthesis.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/playground/03-tinyflow-synth
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>%<span class="w"> </span>../../../tinyflow/tinyflow-synth<span class="w"> </span>-f<span class="w"> </span>run.py
</span></code></pre></div>
<p>Finally run fast-functional gate-level simulation to ensure the
gate-level netlist is correct.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/playground/04-iverilog-ffglsim
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>%<span class="w"> </span>iverilog<span class="w"> </span>-g2012<span class="w"> </span>-o<span class="w"> </span>FullAdder-test<span class="w"> </span><span class="se">\</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span>../../../stdcells/stdcells.v<span class="w"> </span>../03-tinyflow-synth/post-synth.v<span class="w"> </span><span class="se">\</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">    </span>../../../rtl/test/FullAdder-test.v
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>%<span class="w"> </span>./FullAdder-test
</span></code></pre></div>
<h3 id="82-tiny-back-end-manual-flow">8.2. Tiny Back-End Manual Flow</h3>
<p>Let's first run the back-end flow interactively, and then we will create
a corresponding <code>run.py</code> script. Start the place-and-route REPL.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/playground/05-tinyflow-pnr
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>%<span class="w"> </span>../../../tinyflow/tinyflow-pnr
</span></code></pre></div>
<p>Now load the standard view, create the tiny back-end database, and start
the GUI.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>                <span class="n">be</span>  <span class="o">=</span> <span class="s1">&#39;../../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>                <span class="n">gds</span> <span class="o">=</span> <span class="s1">&#39;../../../stdcells/stdcells.gds&#39;</span><span class="p">,</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>              <span class="p">)</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">()</span>
</span></code></pre></div>
<p>Read the gate-level netlist Verilog file into the database.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../03-tinyflow-synth/post-synth.v&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>Create a fixed floorplan.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>                <span class="s1">&#39;a&#39;</span>    <span class="p">:</span> <span class="p">(</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>                <span class="s1">&#39;b&#39;</span>    <span class="p">:</span> <span class="p">(</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>                <span class="s1">&#39;cin&#39;</span>  <span class="p">:</span> <span class="p">(</span>  <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">7.2</span><span class="p">),</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>                <span class="s1">&#39;cout&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mf">29.52</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>                <span class="s1">&#39;sum&#39;</span>  <span class="p">:</span> <span class="p">(</span><span class="mf">29.52</span><span class="p">,</span>  <span class="mf">7.2</span><span class="p">),</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>              <span class="p">}</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span></code></pre></div>
<p>Place and route the design and insert filler cells.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">place_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">multi_route_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">add_filler</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span></code></pre></div>
<p>Check the design for issues and output a summary report.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">check_design</span><span class="p">()</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">report_summary</span><span class="p">()</span>
</span></code></pre></div>
<p>Note that the unoptimized routing algorithm is unlikely to be able to
succesfully route all of the nets. This means we could not fabricate this
design, but it is ok for illustrating the process during the lab. The
optimized place and route algorithms you implement for Project 1C must be
able to successfully route all nets in order to be able to contribute
your block to the tinyflow tapeout.</p>
<p>Write the tiny back-end database to a GDS layout file and exit the REPL.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">write_gds</span><span class="p">(</span><span class="s1">&#39;post-pnr.gds&#39;</span><span class="p">)</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="n">tinyflow</span><span class="o">-</span><span class="n">pnr</span><span class="o">&gt;</span> <span class="n">exit</span><span class="p">()</span>
</span></code></pre></div>
<p>You can now view the final layout using Klayout.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/playground/05-tinyflow-pnr
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>%<span class="w"> </span>klayout<span class="w"> </span>post-pnr.gds
</span></code></pre></div>
<p>Choose <em>Display &gt; Top Level Only</em> to hide the internals of each standard
cell and show just the placement and routing of the standard cells. Try
hiding and showing different metal layers to better visualize the
routing. Spend some time appreciating all your hard work!</p>
<p><img alt="" src="../img/lab4-final-layout.png" /></p>
<p>Create a <code>run.py</code> script to make it easier to run place-and-route.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/playground/05-tinyflow-pnr
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>%<span class="w"> </span>code<span class="w"> </span>run.py
</span></code></pre></div>
<p>Populate the script with the above commands. Note that we do not enable
the GUI when using a <code>run.py</code> script.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">view</span> <span class="o">=</span> <span class="n">StdCellBackEndView</span><span class="p">(</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>         <span class="n">be</span>  <span class="o">=</span> <span class="s1">&#39;../../../stdcells/stdcells-be.yml&#39;</span><span class="p">,</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>         <span class="n">gds</span> <span class="o">=</span> <span class="s1">&#39;../../../stdcells/stdcells.gds&#39;</span><span class="p">,</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>       <span class="p">)</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="n">db</span> <span class="o">=</span> <span class="n">TinyBackEndDB</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s1">&#39;../03-tinyflow-synth/post-synth.v&#39;</span><span class="p">)</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="n">io_locs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a>  <span class="s1">&#39;a&#39;</span>    <span class="p">:</span> <span class="p">(</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a>  <span class="s1">&#39;b&#39;</span>    <span class="p">:</span> <span class="p">(</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">14.4</span><span class="p">),</span>
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>  <span class="s1">&#39;cin&#39;</span>  <span class="p">:</span> <span class="p">(</span>  <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">7.2</span><span class="p">),</span>
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a>  <span class="s1">&#39;cout&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mf">29.52</span><span class="p">,</span> <span class="mf">21.6</span><span class="p">),</span>
</span><span id="__span-60-14"><a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a>  <span class="s1">&#39;sum&#39;</span>  <span class="p">:</span> <span class="p">(</span><span class="mf">29.52</span><span class="p">,</span>  <span class="mf">7.2</span><span class="p">),</span>
</span><span id="__span-60-15"><a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="p">}</span>
</span><span id="__span-60-16"><a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a><span class="n">floorplan_fixed</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="n">io_locs</span><span class="p">)</span>
</span><span id="__span-60-17"><a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a>
</span><span id="__span-60-18"><a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a><span class="n">place_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span><span id="__span-60-19"><a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a><span class="n">multi_route_unopt</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span><span id="__span-60-20"><a id="__codelineno-60-20" name="__codelineno-60-20" href="#__codelineno-60-20"></a><span class="n">add_filler</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span><span id="__span-60-21"><a id="__codelineno-60-21" name="__codelineno-60-21" href="#__codelineno-60-21"></a>
</span><span id="__span-60-22"><a id="__codelineno-60-22" name="__codelineno-60-22" href="#__codelineno-60-22"></a><span class="n">db</span><span class="o">.</span><span class="n">check_design</span><span class="p">()</span>
</span><span id="__span-60-23"><a id="__codelineno-60-23" name="__codelineno-60-23" href="#__codelineno-60-23"></a><span class="n">db</span><span class="o">.</span><span class="n">report_summary</span><span class="p">()</span>
</span><span id="__span-60-24"><a id="__codelineno-60-24" name="__codelineno-60-24" href="#__codelineno-60-24"></a>
</span><span id="__span-60-25"><a id="__codelineno-60-25" name="__codelineno-60-25" href="#__codelineno-60-25"></a><span class="n">db</span><span class="o">.</span><span class="n">write_gds</span><span class="p">(</span><span class="s1">&#39;post-pnr.gds&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>Now rerun place-and-route using this <code>run.py</code> script.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/playground/05-tinyflow-pnr
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>%<span class="w"> </span>../../../tinyflow/tinyflow-pnr<span class="w"> </span>-f<span class="w"> </span>run.py
</span></code></pre></div>
<h3 id="83-tiny-automated-flow">8.3. Tiny Automated Flow</h3>
<p>In the previous sections, we manually commands entering commands for each
tool to take a design from RTL to layout. Using <code>run.py</code> scripts can
help, and we could even crate <code>run</code> Bash scripts to further automate the
flow. However, truly agile hardware design demands more sophisticated
automation to simplify rapidly exploring the design space of one or more
designs. In this section, we will introduce a tool called pyhflow which
takes as input step templates and a design YAML and generates
appropriate flow scripts.</p>
<p>pyflow is based on the idea of step templates which are located in the
asic/steps directory.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/steps
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>%<span class="w"> </span>tree
</span></code></pre></div>
<p>The directory layout should look as follows.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>.
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>├── 01-verilator-rtlsim
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>│   └── run
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>├── 02-iverilog-rtlsim
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>│   └── run
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>├── 03-tinyflow-synth
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>│   ├── run
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>│   └── run.py
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a>├── 04-iverilog-ffglsim
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a>│   └── run
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a>└── 05-tinyflow-pnr
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a>    ├── run
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>    └── run.py
</span></code></pre></div>
<p>Each step is a directory with a run script and possibly other scripts.
The key difference from the <code>run.py</code> and <code>run</code> scripts we used
previously, is that these scripts are templated using the Jinja2
templating system:</p>
<ul>
<li><a href="https://jinja.palletsprojects.com">https://jinja.palletsprojects.com</a></li>
</ul>
<p>Open the <code>run.py</code> script in the <code>03-tinyflow-synth</code> step template.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/steps/03-tinyflow-synth
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>%<span class="w"> </span>code<span class="w"> </span>run.py
</span></code></pre></div>
<p>Notice how the <code>run.py</code> script is templated based on the design name.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="n">db</span><span class="o">.</span><span class="n">read_verilog</span><span class="p">(</span><span class="s2">&quot;{{top_dir}}/rtl/{{design_name}}.v&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>The <code>{{ }}</code> directive is the standard syntax for template variable
substitution using Jinja2. The pyhflow program takes as input a design
YAML file which specifies how to fill in these template variables. Take a
look at the provided design YAML for the full ader.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic/designs
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>%<span class="w"> </span>code<span class="w"> </span>fa.py
</span></code></pre></div>
<p>The contents should look as follows.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>steps:
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a> - 01-verilator-rtlsim
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a> - 02-iverilog-rtlsim
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a> - 03-tinyflow-synth
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a> - 04-iverilog-ffglsim
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a> - 05-tinyflow-pnr
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>top_dir      : ../../..
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>design_name  : FullAdder
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>test         : FullAdder-test
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>block_width  : 30.0
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a>block_height : 30.0
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a>io_locs: |
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a>  &#39;a&#39;    : (  0.0, 21.6),
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a>  &#39;b&#39;    : (  0.0, 14.4),
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a>  &#39;cin&#39;  : (  0.0,  7.2),
</span><span id="__span-67-18"><a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a>  &#39;cout&#39; : (29.52, 21.6),
</span><span id="__span-67-19"><a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a>  &#39;sum&#39;  : (29.52,  7.2),
</span></code></pre></div>
<p>This design YAML file specifies the generated flow should use five steps
and also includes the design name, test name, and floorplan information.
All pyhflow does is use the YAML file to figure out what to substitute
into the templated steps and then copy the run scripts into the current
working directory. You can also override parameters on pyhflow command
line.</p>
<p>Let's now use pyhflow to easily automate the entire process of pushing a
full adder through the tiny flow.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>%<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>build-fa
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build-fa
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>%<span class="w"> </span>pyhflow<span class="w"> </span>../designs/fa.yml
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>%<span class="w"> </span>./01-verilator-rtlsim/run
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>%<span class="w"> </span>./02-iverilog-rtlsim/run
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a>%<span class="w"> </span>./03-tinyflow-synth/run
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>%<span class="w"> </span>./04-iverilog-ffglsim/run
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>%<span class="w"> </span>./05-tinyflow-pnr/run
</span></code></pre></div>
<p>pyhflow also creates a <code>run-flow</code> script which will run all the steps
further simplifying the process.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/ece6745/lab4/asic
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>%<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>build-fa
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build-fa
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>%<span class="w"> </span>pyhflow<span class="w"> </span>../designs/fa.yml
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>%<span class="w"> </span>./run-flow
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Christopher Batten
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../js/extras.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/skins/default.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.1.0/wavedrom.min.js"></script>
      
        <script src="../js/wavedrom_loader.js"></script>
      
    
  </body>
</html>